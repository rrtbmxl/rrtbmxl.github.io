

  
    
  


  




  


  

<!DOCTYPE html>
<html lang="en-us">
  <head>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Hugo 0.54.0 with theme Tranquilpeak 0.4.3-BETA">
    <title>使用机器学习给自己推荐番剧：first try</title>
    <meta name="author" content="孟祥良">
    <meta name="keywords" content="">

    <link rel="icon" href="/favicon.png">
    

    
    <meta name="description" content="A.关于数据B.数据探索b1.番名b2.季数b3.集数b4.年份b5.季节b6.来源b7.类别b8.制作公司b9.评分及人数extra 1.个人、豆瓣与MAL的对比b0.声优extra 2.声优关系网络C.建模与评估c1.清洗数据c2.创建训练数据集和测试数据集c3.朴素贝叶斯算法c4.规则学习算法D.局限与展望花费许多时间学到的东西自然是要用一用的，如果工作中用不到的话，那就用来为生活增添些许乐趣吧。
看番多年，难免遇到烂番，既浪费时间，又影响心情；另外，有些优秀的番剧，可能因为某些原因，与自己失之交臂。要是能在自己看过的番剧的基础上，建立一个模型，帮自己避免烂番，发掘好番，那真是再好不过了。于是我就把自己近年来看过的番剧整理了一下，收集了若干相关信息，做成了excel表格，作为建立模型的原材料。数据是手动整理的，花费的时间比我预计的多很多，但在整理的过程中，也引发了不少回忆，所以也算不上是浪费时间。
A.关于数据数据就是我看番的记录，不全，但应该是足够用了。反应变量是我对某番剧的评分，从5分到10分，是离散数据，在这第一次尝试中，计划将其变为二元分类数据，即5分到7分为不推荐，8分到10分为推荐。预测变量有十来个，包括番剧的年代、类型、制作公司、声优和网站评分等信息，在第一次尝试中，计划把数据弄成稀疏矩阵，使用朴素贝叶斯算法和规则学习算法来进行分类。
在查看数据之前，先载入分析需要用到的包：
library(tidyverse)library(readxl)library(here)library(ggthemes)library(corrplot)library(tidytext)library(widyr)library(igraph)library(ggraph)library(e1071)library(RWeka)library(gmodels)然后导入数据，并进行初步的清洗：
anime &lt;- read_xlsx(here(&#39;content&#39;, &#39;post&#39;, &#39;data&#39;, &#39;anime_record.xlsx&#39;)) %&gt;%mutate_all(str_remove_all, pattern = &#39;\U00A0&#39;) %&gt;% # 去掉不间断空格&lt;U&#43;00A0&gt;select(-record_time) %&gt;%mutate(studio = str_remove(studio, &#39;,.*&#39;)) %&gt;%mutate_at(vars(c(&#39;season_number&#39;, &#39;episode&#39;, &#39;year&#39;, &#39;rating&#39;, &#39;db_number&#39;, &#39;mal_number&#39;)), as.">
    <meta property="og:description" content="A.关于数据B.数据探索b1.番名b2.季数b3.集数b4.年份b5.季节b6.来源b7.类别b8.制作公司b9.评分及人数extra 1.个人、豆瓣与MAL的对比b0.声优extra 2.声优关系网络C.建模与评估c1.清洗数据c2.创建训练数据集和测试数据集c3.朴素贝叶斯算法c4.规则学习算法D.局限与展望花费许多时间学到的东西自然是要用一用的，如果工作中用不到的话，那就用来为生活增添些许乐趣吧。
看番多年，难免遇到烂番，既浪费时间，又影响心情；另外，有些优秀的番剧，可能因为某些原因，与自己失之交臂。要是能在自己看过的番剧的基础上，建立一个模型，帮自己避免烂番，发掘好番，那真是再好不过了。于是我就把自己近年来看过的番剧整理了一下，收集了若干相关信息，做成了excel表格，作为建立模型的原材料。数据是手动整理的，花费的时间比我预计的多很多，但在整理的过程中，也引发了不少回忆，所以也算不上是浪费时间。
A.关于数据数据就是我看番的记录，不全，但应该是足够用了。反应变量是我对某番剧的评分，从5分到10分，是离散数据，在这第一次尝试中，计划将其变为二元分类数据，即5分到7分为不推荐，8分到10分为推荐。预测变量有十来个，包括番剧的年代、类型、制作公司、声优和网站评分等信息，在第一次尝试中，计划把数据弄成稀疏矩阵，使用朴素贝叶斯算法和规则学习算法来进行分类。
在查看数据之前，先载入分析需要用到的包：
library(tidyverse)library(readxl)library(here)library(ggthemes)library(corrplot)library(tidytext)library(widyr)library(igraph)library(ggraph)library(e1071)library(RWeka)library(gmodels)然后导入数据，并进行初步的清洗：
anime &lt;- read_xlsx(here(&#39;content&#39;, &#39;post&#39;, &#39;data&#39;, &#39;anime_record.xlsx&#39;)) %&gt;%mutate_all(str_remove_all, pattern = &#39;\U00A0&#39;) %&gt;% # 去掉不间断空格&lt;U&#43;00A0&gt;select(-record_time) %&gt;%mutate(studio = str_remove(studio, &#39;,.*&#39;)) %&gt;%mutate_at(vars(c(&#39;season_number&#39;, &#39;episode&#39;, &#39;year&#39;, &#39;rating&#39;, &#39;db_number&#39;, &#39;mal_number&#39;)), as.">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="使用机器学习给自己推荐番剧：first try">
    <meta property="og:url" content="/2019/05/anime-recommend-with-ml/">
    <meta property="og:site_name" content="RPG">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="RPG">
    <meta name="twitter:description" content="A.关于数据B.数据探索b1.番名b2.季数b3.集数b4.年份b5.季节b6.来源b7.类别b8.制作公司b9.评分及人数extra 1.个人、豆瓣与MAL的对比b0.声优extra 2.声优关系网络C.建模与评估c1.清洗数据c2.创建训练数据集和测试数据集c3.朴素贝叶斯算法c4.规则学习算法D.局限与展望花费许多时间学到的东西自然是要用一用的，如果工作中用不到的话，那就用来为生活增添些许乐趣吧。
看番多年，难免遇到烂番，既浪费时间，又影响心情；另外，有些优秀的番剧，可能因为某些原因，与自己失之交臂。要是能在自己看过的番剧的基础上，建立一个模型，帮自己避免烂番，发掘好番，那真是再好不过了。于是我就把自己近年来看过的番剧整理了一下，收集了若干相关信息，做成了excel表格，作为建立模型的原材料。数据是手动整理的，花费的时间比我预计的多很多，但在整理的过程中，也引发了不少回忆，所以也算不上是浪费时间。
A.关于数据数据就是我看番的记录，不全，但应该是足够用了。反应变量是我对某番剧的评分，从5分到10分，是离散数据，在这第一次尝试中，计划将其变为二元分类数据，即5分到7分为不推荐，8分到10分为推荐。预测变量有十来个，包括番剧的年代、类型、制作公司、声优和网站评分等信息，在第一次尝试中，计划把数据弄成稀疏矩阵，使用朴素贝叶斯算法和规则学习算法来进行分类。
在查看数据之前，先载入分析需要用到的包：
library(tidyverse)library(readxl)library(here)library(ggthemes)library(corrplot)library(tidytext)library(widyr)library(igraph)library(ggraph)library(e1071)library(RWeka)library(gmodels)然后导入数据，并进行初步的清洗：
anime &lt;- read_xlsx(here(&#39;content&#39;, &#39;post&#39;, &#39;data&#39;, &#39;anime_record.xlsx&#39;)) %&gt;%mutate_all(str_remove_all, pattern = &#39;\U00A0&#39;) %&gt;% # 去掉不间断空格&lt;U&#43;00A0&gt;select(-record_time) %&gt;%mutate(studio = str_remove(studio, &#39;,.*&#39;)) %&gt;%mutate_at(vars(c(&#39;season_number&#39;, &#39;episode&#39;, &#39;year&#39;, &#39;rating&#39;, &#39;db_number&#39;, &#39;mal_number&#39;)), as.">
    
    

    
    

    
      <meta property="og:image" content="//www.gravatar.com/avatar/9a7089fad6e7d2ebee69f9659db0c484?s=640">
    

    
    
    

    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.min.css" integrity="sha256-vuXZ9LGmmwtjqFX1F+EKin1ThZMub58gKULUyf0qECk=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-thumbs.min.css" integrity="sha256-SEa4XYAHihTcEP1f5gARTB2K26Uk8PsndQYHQC1f4jU=" crossorigin="anonymous" />
    
    
    <link rel="stylesheet" href="/css/style-jsjn0006wyhpyzivf6yceb31gvpjatbcs3qzjvlumobfnugccvobqwxnnaj8.min.css" />
    
    

    
      
    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="4">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="/">RPG</a>
  </div>
  
    
      <a class="header-right-picture "
         href="/#about">
    
    
    
      
        <img class="header-picture" src="//www.gravatar.com/avatar/9a7089fad6e7d2ebee69f9659db0c484?s=90" alt="Author&#39;s picture" />
      
    
    </a>
  
</header>

      <nav id="sidebar" data-behavior="4">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="/#about">
          <img class="sidebar-profile-picture" src="//www.gravatar.com/avatar/9a7089fad6e7d2ebee69f9659db0c484?s=110" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">孟祥良</h4>
        
          <h5 class="sidebar-profile-bio">R语言爱好者, 心理学专业硕士 &amp; FGO休闲玩家</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/categories">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/tags">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/archives">
    
      <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
      
      <span class="sidebar-button-desc">Archives</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/#about">
    
      <i class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/rrtbmxl/rrtbmxl.github.io">
    
      <i class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/">
    
      
      
      <span class="sidebar-button-desc"></span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="/">
    
      
      
      <span class="sidebar-button-desc"></span>
    </a>
  </li>


    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="4"
        class="
               hasCoverMetaIn
               ">
        <article class="post" itemscope itemType="http://schema.org/BlogPosting">
          
          
            <div class="post-header main-content-wrap text-left">
  
    <h1 class="post-title" itemprop="headline">
      使用机器学习给自己推荐番剧：first try
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time itemprop="datePublished" datetime="2019-05-12T00:00:00Z">
        
  May 12, 2019

      </time>
    
    
  
  
    <span>in</span>
    
      <a class="category-link" href="/categories/r">R</a>
    
  

  </div>

</div>
          
          <div class="post-content markdown" itemprop="articleBody">
            <div class="main-content-wrap">
              

<div id="TOC">
<ul>
<li><a href="#a.">A.关于数据</a></li>
<li><a href="#b.">B.数据探索</a><ul>
<li><a href="#b1.">b1.番名</a></li>
<li><a href="#b2.">b2.季数</a></li>
<li><a href="#b3.">b3.集数</a></li>
<li><a href="#b4.">b4.年份</a></li>
<li><a href="#b5.">b5.季节</a></li>
<li><a href="#b6.">b6.来源</a></li>
<li><a href="#b7.">b7.类别</a></li>
<li><a href="#b8.">b8.制作公司</a></li>
<li><a href="#b9.">b9.评分及人数</a></li>
<li><a href="#extra-1.mal">extra 1.个人、豆瓣与MAL的对比</a></li>
<li><a href="#b0.">b0.声优</a></li>
<li><a href="#extra-2.">extra 2.声优关系网络</a></li>
</ul></li>
<li><a href="#c.">C.建模与评估</a><ul>
<li><a href="#c1.">c1.清洗数据</a></li>
<li><a href="#c2.">c2.创建训练数据集和测试数据集</a></li>
<li><a href="#c3.">c3.朴素贝叶斯算法</a></li>
<li><a href="#c4.">c4.规则学习算法</a></li>
</ul></li>
<li><a href="#d.">D.局限与展望</a></li>
</ul>
</div>

<p>花费许多时间学到的东西自然是要用一用的，如果工作中用不到的话，那就用来为生活增添些许乐趣吧。</p>
<p>看番多年，难免遇到烂番，既浪费时间，又影响心情；另外，有些优秀的番剧，可能因为某些原因，与自己失之交臂。要是能在自己看过的番剧的基础上，建立一个模型，帮自己避免烂番，发掘好番，那真是再好不过了。于是我就把自己近年来看过的番剧整理了一下，收集了若干相关信息，做成了excel表格，作为建立模型的原材料。数据是手动整理的，花费的时间比我预计的多很多，但在整理的过程中，也引发了不少回忆，所以也算不上是浪费时间。</p>
<div id="a." class="section level1">
<h1>A.关于数据</h1>
<p>数据就是我看番的记录，不全，但应该是足够用了。反应变量是我对某番剧的评分，从5分到10分，是离散数据，在这第一次尝试中，计划将其变为二元分类数据，即5分到7分为不推荐，8分到10分为推荐。预测变量有十来个，包括番剧的年代、类型、制作公司、声优和网站评分等信息，在第一次尝试中，计划把数据弄成稀疏矩阵，使用朴素贝叶斯算法和规则学习算法来进行分类。</p>
<p>在查看数据之前，先载入分析需要用到的包：</p>
<pre class="r"><code>library(tidyverse)
library(readxl)
library(here)
library(ggthemes)
library(corrplot)
library(tidytext)
library(widyr)
library(igraph)
library(ggraph)
library(e1071)
library(RWeka)
library(gmodels)</code></pre>
<p>然后导入数据，并进行初步的清洗：</p>
<pre class="r"><code>anime &lt;- read_xlsx(here(&#39;content&#39;, &#39;post&#39;, &#39;data&#39;, &#39;anime_record.xlsx&#39;)) %&gt;%
  mutate_all(str_remove_all, pattern = &#39;\U00A0&#39;) %&gt;% # 去掉不间断空格&lt;U+00A0&gt;
  select(-record_time) %&gt;%
  mutate(studio = str_remove(studio, &#39;,.*&#39;)) %&gt;%
  mutate_at(vars(c(&#39;season_number&#39;, &#39;episode&#39;, &#39;year&#39;, &#39;rating&#39;, 
                   &#39;db_number&#39;, &#39;mal_number&#39;)), as.integer) %&gt;% 
  mutate_at(vars(c(&#39;db_rating&#39;, &#39;mal_rating&#39;)), as.numeric)</code></pre>
<p>看一下数据的情况：</p>
<pre class="r"><code>glimpse(anime)</code></pre>
<pre><code>## Observations: 186
## Variables: 15
## $ name          &lt;chr&gt; &quot;新世纪福音战士&quot;, &quot;钢之炼金术师&quot;, &quot;妖精的旋律&quot;, &quot;蔷薇少女&quot;, &quot;地狱少女&quot;, &quot;蔷...
## $ series        &lt;chr&gt; &quot;新世纪福音战士&quot;, &quot;钢之炼金术师&quot;, &quot;妖精的旋律&quot;, &quot;蔷薇少女&quot;, &quot;地狱少女&quot;, &quot;蔷...
## $ season_number &lt;int&gt; 1, 1, 1, 1, 1, 2, 1, 1, 1, 1, 2, 1, 1, 1, 1, 1, ...
## $ episode       &lt;int&gt; 26, 51, 13, 12, 26, 12, 24, 24, 14, 24, 26, 25, ...
## $ year          &lt;int&gt; 1995, 2003, 2004, 2004, 2005, 2005, 2005, 2006, ...
## $ season        &lt;chr&gt; &quot;秋&quot;, &quot;秋&quot;, &quot;夏&quot;, &quot;秋&quot;, &quot;秋&quot;, &quot;秋&quot;, &quot;秋&quot;, &quot;冬&quot;, &quot;春&quot;, &quot;春&quot;...
## $ origin        &lt;chr&gt; &quot;原创&quot;, &quot;漫改&quot;, &quot;漫改&quot;, &quot;漫改&quot;, &quot;原创&quot;, &quot;漫改&quot;, &quot;轻改&quot;, &quot;游改&quot;, ...
## $ genra         &lt;chr&gt; &quot;Action,Dementia,Drama,Mecha,Psychological,Sci-F...
## $ studio        &lt;chr&gt; &quot;Gainax&quot;, &quot;Bones&quot;, &quot;Arms&quot;, &quot;Nomad&quot;, &quot;Studio Deen...
## $ rating        &lt;int&gt; 8, 8, 8, 7, 7, 7, 7, 7, 10, 8, 7, 10, 10, 9, 6, ...
## $ db_rating     &lt;dbl&gt; 9.4, 9.2, 8.2, 7.7, 7.8, 8.0, 7.4, 7.7, 8.5, 8.9...
## $ db_number     &lt;int&gt; 69782, 48049, 13862, 6478, 17827, 2626, 12445, 2...
## $ mal_rating    &lt;dbl&gt; 8.33, 8.27, 7.71, 7.52, 7.73, 7.72, 7.63, 7.49, ...
## $ mal_number    &lt;int&gt; 416593, 538905, 562900, 77500, 90143, 48980, 193...
## $ cast          &lt;chr&gt; &quot;绪方惠美/林原惠美/三石琴乃/宫村优子/山口由里子/立木文彦/清川元梦/山寺宏一/关智一/岩永...</code></pre>
<p>可以看到，共有186行数据，15列变量。下面简单介绍下变量：</p>
<ul>
<li><p><strong>name</strong>：番剧的名称；</p></li>
<li><p><strong>series</strong>：番剧的系列名，也就是番剧第一季的名字；</p></li>
<li><p><strong>season_number</strong>：番剧的季数；</p></li>
<li><p><strong>episode</strong>：番剧的总集数；</p></li>
<li><p><strong>year</strong>：番剧首播的年份；</p></li>
<li><p><strong>season</strong>：番剧首播的季节；</p></li>
<li><p><strong>origin</strong>；番剧的来源，即由什么而改编；</p></li>
<li><p><strong>genra</strong>：番剧的类型；</p></li>
<li><p><strong>studio</strong>：番剧的制作公司；</p></li>
<li><p><strong>rating</strong>；我个人对番剧的评分，即反应变量；</p></li>
<li><p><strong>db_rating</strong>：豆瓣上对番剧的评分；</p></li>
<li><p><strong>db_number</strong>：豆瓣上对番剧评分的人数；</p></li>
<li><p><strong>mal_rating</strong>：MAL上对番剧的评分；</p></li>
<li><p><strong>mal_number</strong>：MAL上对番剧评分的人数；</p></li>
<li><p><strong>cast</strong>：番剧的声优</p></li>
</ul>
<p>其实还有很多其他信息可以收集的，如监督、配乐、原画、作者、销量等信息，但我都没有记录，因为觉得这些信息对我看不看某个番剧没有太大的影响（毕竟人方面主要还是看声优，监督是谁，一般并不关心；而销量也没怎么关注过）。</p>
<p>变量介绍到此，下面开始对数据进行探索。</p>
</div>
<div id="b." class="section level1">
<h1>B.数据探索</h1>
<p>探索前说一下缺失值的问题。整份数据中只有2个缺失值，是《死亡笔记》的豆瓣评分和豆瓣人数，因为被和谐的原因，竟然在豆瓣上连个条目都没有。不过，在最后建模的时候，我也没有用到这两个变量，所以这个问题不算个问题。</p>
<p>在后面的数据探索中，我频繁地使用同样的几行代码对数据进行统计，为了节省代码，就先写了个函数：</p>
<pre class="r"><code>my_awesome_summary &lt;- function(data) {
  data %&gt;% summarise(N = n(), rating = mean(rating), 
            db_rating = mean(db_rating, na.rm = TRUE), 
            db_number = mean(db_number, na.rm = TRUE),
            mal_rating = mean(mal_rating), mal_number = mean(mal_number))
}</code></pre>
<p>该函数会在分类的基础上，计算各类别的个数及若干变量的平均值。当然，最好不要用<code>my_awesome_summary</code>这种函数名。</p>
<div id="b1." class="section level3">
<h3>b1.番名</h3>
<p>番名肯定会对我决定看不看某个番产生一定的影响，在中二的年代，《死亡笔记》《反叛的鲁路修》这样的名字，确实很有吸引力。不过，我不知道该如何使用这一变量，所以没有在后面的模型中用到。但这一变量倒在清洗数据时发挥了一定的作用。</p>
</div>
<div id="b2." class="section level3">
<h3>b2.季数</h3>
<p>先看一下按季数进行分类的情况：</p>
<pre class="r"><code>anime %&gt;% group_by(season_number) %&gt;% 
  my_awesome_summary() %&gt;% 
  knitr::kable(digits = 2)</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">season_number</th>
<th align="right">N</th>
<th align="right">rating</th>
<th align="right">db_rating</th>
<th align="right">db_number</th>
<th align="right">mal_rating</th>
<th align="right">mal_number</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">125</td>
<td align="right">7.55</td>
<td align="right">8.18</td>
<td align="right">17152.02</td>
<td align="right">7.85</td>
<td align="right">242829.1</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">46</td>
<td align="right">7.78</td>
<td align="right">8.35</td>
<td align="right">10009.17</td>
<td align="right">8.00</td>
<td align="right">184294.9</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">10</td>
<td align="right">7.40</td>
<td align="right">7.95</td>
<td align="right">11612.10</td>
<td align="right">7.88</td>
<td align="right">108821.9</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">3</td>
<td align="right">7.33</td>
<td align="right">7.80</td>
<td align="right">17342.00</td>
<td align="right">7.27</td>
<td align="right">50593.0</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">1</td>
<td align="right">9.00</td>
<td align="right">9.50</td>
<td align="right">26317.00</td>
<td align="right">8.63</td>
<td align="right">38075.0</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">1</td>
<td align="right">9.00</td>
<td align="right">9.50</td>
<td align="right">19896.00</td>
<td align="right">8.71</td>
<td align="right">31475.0</td>
</tr>
</tbody>
</table>
<p>超过3季的番很少，实际上，也就只有《夏目友人帐》作到了第六季。考虑将第2季及后续的合并在一起，与第1季进行对比：</p>
<pre class="r"><code>anime %&gt;% mutate(season_state = ifelse(season_number == 1, &#39;first&#39;, &#39;second+&#39;)) %&gt;% 
  group_by(season_state) %&gt;% 
  my_awesome_summary() %&gt;% 
  knitr::kable(digits = 2)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">season_state</th>
<th align="right">N</th>
<th align="right">rating</th>
<th align="right">db_rating</th>
<th align="right">db_number</th>
<th align="right">mal_rating</th>
<th align="right">mal_number</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">first</td>
<td align="right">125</td>
<td align="right">7.55</td>
<td align="right">8.18</td>
<td align="right">17152.02</td>
<td align="right">7.85</td>
<td align="right">242829.1</td>
</tr>
<tr class="even">
<td align="left">second+</td>
<td align="right">61</td>
<td align="right">7.74</td>
<td align="right">8.29</td>
<td align="right">11062.00</td>
<td align="right">7.97</td>
<td align="right">160444.5</td>
</tr>
</tbody>
</table>
<p>从评分来看，后续的番剧确实要比第1季的番剧要好一些，因此我有一个猜测，即如果某个番剧出了续集，则它更值得观看。筛选一下数据，进行对比：</p>
<pre class="r"><code>anime %&gt;% 
  mutate(season_more = ifelse(series %in% (anime %&gt;% filter(season_number &gt; 1) %&gt;% 
                                             pull(series) %&gt;% unique()), &#39;yes&#39;, &#39;no&#39;)) %&gt;% 
  group_by(season_more) %&gt;% 
  my_awesome_summary() %&gt;% 
  knitr::kable(digits = 2)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">season_more</th>
<th align="right">N</th>
<th align="right">rating</th>
<th align="right">db_rating</th>
<th align="right">db_number</th>
<th align="right">mal_rating</th>
<th align="right">mal_number</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">no</td>
<td align="right">82</td>
<td align="right">7.40</td>
<td align="right">8.11</td>
<td align="right">14753.23</td>
<td align="right">7.81</td>
<td align="right">202685.0</td>
</tr>
<tr class="even">
<td align="left">yes</td>
<td align="right">104</td>
<td align="right">7.78</td>
<td align="right">8.30</td>
<td align="right">15448.27</td>
<td align="right">7.96</td>
<td align="right">226159.4</td>
</tr>
</tbody>
</table>
<p>这样一对比就更明显了，但有一点需要注意，就是数据中的某个“没有”后续的番剧可能并不是没有后续，只是我没有去看。</p>
<p>第一个变量提取出来了，即有无后续。</p>
</div>
<div id="b3." class="section level3">
<h3>b3.集数</h3>
<p>下面看下集数变量的情况：</p>
<pre class="r"><code>anime %&gt;% group_by(episode) %&gt;% 
  my_awesome_summary() %&gt;% 
  knitr::kable(digits = 2)</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">episode</th>
<th align="right">N</th>
<th align="right">rating</th>
<th align="right">db_rating</th>
<th align="right">db_number</th>
<th align="right">mal_rating</th>
<th align="right">mal_number</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">4</td>
<td align="right">1</td>
<td align="right">7.00</td>
<td align="right">8.60</td>
<td align="right">6007.00</td>
<td align="right">8.03</td>
<td align="right">183539.0</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">1</td>
<td align="right">7.00</td>
<td align="right">7.30</td>
<td align="right">2778.00</td>
<td align="right">6.60</td>
<td align="right">10205.0</td>
</tr>
<tr class="odd">
<td align="right">10</td>
<td align="right">4</td>
<td align="right">6.75</td>
<td align="right">7.95</td>
<td align="right">4844.50</td>
<td align="right">7.73</td>
<td align="right">212081.0</td>
</tr>
<tr class="even">
<td align="right">11</td>
<td align="right">6</td>
<td align="right">8.17</td>
<td align="right">8.75</td>
<td align="right">25299.67</td>
<td align="right">8.27</td>
<td align="right">180340.3</td>
</tr>
<tr class="odd">
<td align="right">12</td>
<td align="right">74</td>
<td align="right">7.46</td>
<td align="right">8.08</td>
<td align="right">11506.42</td>
<td align="right">7.72</td>
<td align="right">172649.2</td>
</tr>
<tr class="even">
<td align="right">13</td>
<td align="right">40</td>
<td align="right">7.62</td>
<td align="right">8.41</td>
<td align="right">16667.53</td>
<td align="right">7.98</td>
<td align="right">175268.0</td>
</tr>
<tr class="odd">
<td align="right">14</td>
<td align="right">2</td>
<td align="right">10.00</td>
<td align="right">8.65</td>
<td align="right">17240.50</td>
<td align="right">7.61</td>
<td align="right">262674.5</td>
</tr>
<tr class="even">
<td align="right">15</td>
<td align="right">1</td>
<td align="right">8.00</td>
<td align="right">8.60</td>
<td align="right">22429.00</td>
<td align="right">8.35</td>
<td align="right">403140.0</td>
</tr>
<tr class="odd">
<td align="right">16</td>
<td align="right">2</td>
<td align="right">7.00</td>
<td align="right">7.05</td>
<td align="right">3839.00</td>
<td align="right">7.00</td>
<td align="right">105944.5</td>
</tr>
<tr class="even">
<td align="right">21</td>
<td align="right">1</td>
<td align="right">7.00</td>
<td align="right">8.50</td>
<td align="right">9951.00</td>
<td align="right">7.66</td>
<td align="right">65534.0</td>
</tr>
<tr class="odd">
<td align="right">22</td>
<td align="right">4</td>
<td align="right">8.00</td>
<td align="right">8.33</td>
<td align="right">24685.50</td>
<td align="right">8.30</td>
<td align="right">425028.2</td>
</tr>
<tr class="even">
<td align="right">23</td>
<td align="right">2</td>
<td align="right">9.50</td>
<td align="right">9.00</td>
<td align="right">14174.00</td>
<td align="right">8.39</td>
<td align="right">289716.0</td>
</tr>
<tr class="odd">
<td align="right">24</td>
<td align="right">22</td>
<td align="right">7.68</td>
<td align="right">8.20</td>
<td align="right">15641.68</td>
<td align="right">8.00</td>
<td align="right">272950.6</td>
</tr>
<tr class="even">
<td align="right">25</td>
<td align="right">11</td>
<td align="right">8.36</td>
<td align="right">8.48</td>
<td align="right">28003.55</td>
<td align="right">8.37</td>
<td align="right">453407.4</td>
</tr>
<tr class="odd">
<td align="right">26</td>
<td align="right">11</td>
<td align="right">6.64</td>
<td align="right">7.66</td>
<td align="right">13373.00</td>
<td align="right">7.71</td>
<td align="right">109467.4</td>
</tr>
<tr class="even">
<td align="right">37</td>
<td align="right">1</td>
<td align="right">10.00</td>
<td align="right">NaN</td>
<td align="right">NaN</td>
<td align="right">8.66</td>
<td align="right">1139551.0</td>
</tr>
<tr class="odd">
<td align="right">51</td>
<td align="right">1</td>
<td align="right">8.00</td>
<td align="right">9.20</td>
<td align="right">48049.00</td>
<td align="right">8.27</td>
<td align="right">538905.0</td>
</tr>
<tr class="even">
<td align="right">52</td>
<td align="right">1</td>
<td align="right">7.00</td>
<td align="right">9.00</td>
<td align="right">838.00</td>
<td align="right">7.60</td>
<td align="right">6491.0</td>
</tr>
<tr class="odd">
<td align="right">64</td>
<td align="right">1</td>
<td align="right">10.00</td>
<td align="right">9.60</td>
<td align="right">53720.00</td>
<td align="right">9.24</td>
<td align="right">862938.0</td>
</tr>
</tbody>
</table>
<p>集数的类型还挺多的，我对此进行了简化，将超过20集的视为长篇，不足20集的视为短篇。这里其实并没有真正的长篇，毕竟最长的也才64集（钢炼FA），不过我没有把看过的长篇统计在内，所以这么称呼也可以吧：</p>
<pre class="r"><code>anime %&gt;% mutate(episode = ifelse(episode &lt; 20, &#39;short&#39;, &#39;long&#39;),
                 episode = factor(episode, levels = c(&#39;short&#39;, &#39;long&#39;))) %&gt;% 
  group_by(episode) %&gt;% 
  my_awesome_summary() %&gt;% 
  knitr::kable(digits = 2)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">episode</th>
<th align="right">N</th>
<th align="right">rating</th>
<th align="right">db_rating</th>
<th align="right">db_number</th>
<th align="right">mal_rating</th>
<th align="right">mal_number</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">short</td>
<td align="right">131</td>
<td align="right">7.55</td>
<td align="right">8.20</td>
<td align="right">13455.92</td>
<td align="right">7.81</td>
<td align="right">175963.8</td>
</tr>
<tr class="even">
<td align="left">long</td>
<td align="right">55</td>
<td align="right">7.76</td>
<td align="right">8.25</td>
<td align="right">19239.02</td>
<td align="right">8.08</td>
<td align="right">310718.2</td>
</tr>
</tbody>
</table>
<p>在我的评分中，长篇的确实更好一些，但其实这也挺危险的，因为万一是个长篇的烂番的话，那可真是让人加倍的烦躁了。</p>
<p>第二个变量为是否是长篇。</p>
</div>
<div id="b4." class="section level3">
<h3>b4.年份</h3>
<p>还是先看一下各年份的情况：</p>
<pre class="r"><code>anime %&gt;% group_by(year) %&gt;% 
  my_awesome_summary() %&gt;% 
  knitr::kable(digits = 2)</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">year</th>
<th align="right">N</th>
<th align="right">rating</th>
<th align="right">db_rating</th>
<th align="right">db_number</th>
<th align="right">mal_rating</th>
<th align="right">mal_number</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1995</td>
<td align="right">1</td>
<td align="right">8.00</td>
<td align="right">9.40</td>
<td align="right">69782.00</td>
<td align="right">8.33</td>
<td align="right">416593.00</td>
</tr>
<tr class="even">
<td align="right">2003</td>
<td align="right">1</td>
<td align="right">8.00</td>
<td align="right">9.20</td>
<td align="right">48049.00</td>
<td align="right">8.27</td>
<td align="right">538905.00</td>
</tr>
<tr class="odd">
<td align="right">2004</td>
<td align="right">2</td>
<td align="right">7.50</td>
<td align="right">7.95</td>
<td align="right">10170.00</td>
<td align="right">7.62</td>
<td align="right">320200.00</td>
</tr>
<tr class="even">
<td align="right">2005</td>
<td align="right">3</td>
<td align="right">7.00</td>
<td align="right">7.73</td>
<td align="right">10966.00</td>
<td align="right">7.69</td>
<td align="right">110749.00</td>
</tr>
<tr class="odd">
<td align="right">2006</td>
<td align="right">6</td>
<td align="right">8.67</td>
<td align="right">8.46</td>
<td align="right">26425.20</td>
<td align="right">8.16</td>
<td align="right">433357.33</td>
</tr>
<tr class="even">
<td align="right">2007</td>
<td align="right">5</td>
<td align="right">8.00</td>
<td align="right">8.16</td>
<td align="right">14301.60</td>
<td align="right">7.52</td>
<td align="right">226445.60</td>
</tr>
<tr class="odd">
<td align="right">2008</td>
<td align="right">8</td>
<td align="right">8.38</td>
<td align="right">8.59</td>
<td align="right">28915.62</td>
<td align="right">8.33</td>
<td align="right">288890.50</td>
</tr>
<tr class="even">
<td align="right">2009</td>
<td align="right">11</td>
<td align="right">8.09</td>
<td align="right">8.55</td>
<td align="right">21519.36</td>
<td align="right">7.95</td>
<td align="right">218160.18</td>
</tr>
<tr class="odd">
<td align="right">2010</td>
<td align="right">6</td>
<td align="right">7.33</td>
<td align="right">8.00</td>
<td align="right">17073.00</td>
<td align="right">7.91</td>
<td align="right">329771.33</td>
</tr>
<tr class="even">
<td align="right">2011</td>
<td align="right">11</td>
<td align="right">7.91</td>
<td align="right">8.39</td>
<td align="right">27114.55</td>
<td align="right">8.12</td>
<td align="right">285201.36</td>
</tr>
<tr class="odd">
<td align="right">2012</td>
<td align="right">14</td>
<td align="right">7.50</td>
<td align="right">8.26</td>
<td align="right">17267.93</td>
<td align="right">7.91</td>
<td align="right">251625.21</td>
</tr>
<tr class="even">
<td align="right">2013</td>
<td align="right">13</td>
<td align="right">7.23</td>
<td align="right">8.03</td>
<td align="right">12966.00</td>
<td align="right">7.77</td>
<td align="right">217733.46</td>
</tr>
<tr class="odd">
<td align="right">2014</td>
<td align="right">15</td>
<td align="right">7.53</td>
<td align="right">8.18</td>
<td align="right">15401.33</td>
<td align="right">7.87</td>
<td align="right">314657.53</td>
</tr>
<tr class="even">
<td align="right">2015</td>
<td align="right">20</td>
<td align="right">7.40</td>
<td align="right">7.88</td>
<td align="right">9747.45</td>
<td align="right">7.68</td>
<td align="right">197773.05</td>
</tr>
<tr class="odd">
<td align="right">2016</td>
<td align="right">15</td>
<td align="right">7.60</td>
<td align="right">8.38</td>
<td align="right">16410.53</td>
<td align="right">8.11</td>
<td align="right">241646.60</td>
</tr>
<tr class="even">
<td align="right">2017</td>
<td align="right">16</td>
<td align="right">7.69</td>
<td align="right">8.28</td>
<td align="right">11513.88</td>
<td align="right">7.99</td>
<td align="right">170416.75</td>
</tr>
<tr class="odd">
<td align="right">2018</td>
<td align="right">38</td>
<td align="right">7.34</td>
<td align="right">8.11</td>
<td align="right">7271.58</td>
<td align="right">7.72</td>
<td align="right">84959.74</td>
</tr>
<tr class="even">
<td align="right">2019</td>
<td align="right">1</td>
<td align="right">9.00</td>
<td align="right">9.70</td>
<td align="right">15215.00</td>
<td align="right">9.00</td>
<td align="right">45057.00</td>
</tr>
</tbody>
</table>
<p>数据中的旧番挺少的，主要是因为我是对我网盘里有资源的番剧进行的整理，而很多旧番，已经找不到资源了。另外，2018年的番剧，我竟然看了38部，看来去年是挺焦虑的，需要大量看番来缓解。不过，那年番剧的整理质量似乎挺差的，高质量的番剧，主要还是集中在2008年前后。</p>
<p>同样为了简化，我将2015年设为节点，之前的归类为旧番，剩下的归类为新番。看一下分类后的情况：</p>
<pre class="r"><code>anime %&gt;% mutate(year = ifelse(year &lt; 2015, &#39;old&#39;, &#39;new&#39;),
                 year = factor(year, levels = c(&#39;old&#39;, &#39;new&#39;))) %&gt;% 
  group_by(year) %&gt;% 
  my_awesome_summary() %&gt;% 
  knitr::kable(digits = 2)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">year</th>
<th align="right">N</th>
<th align="right">rating</th>
<th align="right">db_rating</th>
<th align="right">db_number</th>
<th align="right">mal_rating</th>
<th align="right">mal_number</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">old</td>
<td align="right">96</td>
<td align="right">7.74</td>
<td align="right">8.28</td>
<td align="right">19839.66</td>
<td align="right">7.94</td>
<td align="right">276670.8</td>
</tr>
<tr class="even">
<td align="left">new</td>
<td align="right">90</td>
<td align="right">7.48</td>
<td align="right">8.15</td>
<td align="right">10187.38</td>
<td align="right">7.84</td>
<td align="right">150892.8</td>
</tr>
</tbody>
</table>
<p>番还是老的香啊！</p>
<p>第三个变量就是是否为旧番了。</p>
</div>
<div id="b5." class="section level3">
<h3>b5.季节</h3>
<p>番剧一般都是在1月、4月、7月和10月开始播出，对应冬番、春番、夏番和秋番。先看一下各季节的番剧情况：</p>
<pre class="r"><code>anime %&gt;% group_by(season) %&gt;% 
  my_awesome_summary() %&gt;% 
  knitr::kable(digits = 2)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">season</th>
<th align="right">N</th>
<th align="right">rating</th>
<th align="right">db_rating</th>
<th align="right">db_number</th>
<th align="right">mal_rating</th>
<th align="right">mal_number</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">春</td>
<td align="right">54</td>
<td align="right">7.70</td>
<td align="right">8.21</td>
<td align="right">16097.13</td>
<td align="right">7.88</td>
<td align="right">240018.5</td>
</tr>
<tr class="even">
<td align="left">冬</td>
<td align="right">41</td>
<td align="right">7.59</td>
<td align="right">8.37</td>
<td align="right">13337.20</td>
<td align="right">8.00</td>
<td align="right">185731.2</td>
</tr>
<tr class="odd">
<td align="left">秋</td>
<td align="right">55</td>
<td align="right">7.58</td>
<td align="right">8.12</td>
<td align="right">14144.80</td>
<td align="right">7.89</td>
<td align="right">218163.4</td>
</tr>
<tr class="even">
<td align="left">夏</td>
<td align="right">36</td>
<td align="right">7.56</td>
<td align="right">8.18</td>
<td align="right">17270.64</td>
<td align="right">7.78</td>
<td align="right">210160.7</td>
</tr>
</tbody>
</table>
<p>就我个人的评分而言，似乎是春番更好一些，但实际上，我看番是以补为主，以追为辅，大部分的情况下，我都意识不到这部番当年是在哪个季节里播出的，所以这个变量就先不用了。</p>
</div>
<div id="b6." class="section level3">
<h3>b6.来源</h3>
<p>来源主要包括漫画、轻小说、游戏和原创，也有个别来源不明的以及由正统小说改编的，放进了其他类别里（有一个小说改编的，我错误的放进了轻改里，但忘了是哪个了）。看一下各来源的情况：</p>
<pre class="r"><code>anime %&gt;% group_by(origin) %&gt;% 
  my_awesome_summary() %&gt;% 
  knitr::kable(digits = 2)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">origin</th>
<th align="right">N</th>
<th align="right">rating</th>
<th align="right">db_rating</th>
<th align="right">db_number</th>
<th align="right">mal_rating</th>
<th align="right">mal_number</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">漫改</td>
<td align="right">90</td>
<td align="right">7.77</td>
<td align="right">8.52</td>
<td align="right">17356.28</td>
<td align="right">7.92</td>
<td align="right">192463.5</td>
</tr>
<tr class="even">
<td align="left">其他</td>
<td align="right">5</td>
<td align="right">7.20</td>
<td align="right">8.04</td>
<td align="right">5778.80</td>
<td align="right">7.70</td>
<td align="right">66330.2</td>
</tr>
<tr class="odd">
<td align="left">轻改</td>
<td align="right">58</td>
<td align="right">7.40</td>
<td align="right">7.88</td>
<td align="right">10436.43</td>
<td align="right">7.86</td>
<td align="right">244139.0</td>
</tr>
<tr class="even">
<td align="left">游改</td>
<td align="right">10</td>
<td align="right">7.90</td>
<td align="right">8.18</td>
<td align="right">16663.90</td>
<td align="right">7.88</td>
<td align="right">282510.7</td>
</tr>
<tr class="odd">
<td align="left">原创</td>
<td align="right">23</td>
<td align="right">7.52</td>
<td align="right">7.92</td>
<td align="right">19829.43</td>
<td align="right">7.90</td>
<td align="right">239227.0</td>
</tr>
</tbody>
</table>
<p>我看的番剧有一半是由漫画改编的，我对这些番剧的评分也还不错，但是，我几乎从来没有因为看过某个漫画或轻小说而去看某个动画的（没有时间啊），也不会因为看了某个番剧，觉得好看，而去追原作的（一拳超人是个例外），所以这个变量对我看不看某个番剧应该也没啥太大的影响，先放弃了。</p>
</div>
<div id="b7." class="section level3">
<h3>b7.类别</h3>
<p>番剧类别一共由30多种，先看下整体的情况：</p>
<pre class="r"><code>anime %&gt;% separate_rows(genra, sep = &#39;,&#39;) %&gt;% 
  group_by(genra) %&gt;% 
  my_awesome_summary() %&gt;% 
  arrange(-N) %&gt;% 
  knitr::kable(digits = 2)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">genra</th>
<th align="right">N</th>
<th align="right">rating</th>
<th align="right">db_rating</th>
<th align="right">db_number</th>
<th align="right">mal_rating</th>
<th align="right">mal_number</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Comedy</td>
<td align="right">92</td>
<td align="right">7.55</td>
<td align="right">8.30</td>
<td align="right">12362.05</td>
<td align="right">7.82</td>
<td align="right">192869.58</td>
</tr>
<tr class="even">
<td align="left">Action</td>
<td align="right">70</td>
<td align="right">7.61</td>
<td align="right">8.09</td>
<td align="right">17106.83</td>
<td align="right">7.93</td>
<td align="right">292958.14</td>
</tr>
<tr class="odd">
<td align="left">School</td>
<td align="right">60</td>
<td align="right">7.45</td>
<td align="right">8.14</td>
<td align="right">13528.15</td>
<td align="right">7.79</td>
<td align="right">213940.98</td>
</tr>
<tr class="even">
<td align="left">Slice of Life</td>
<td align="right">58</td>
<td align="right">7.78</td>
<td align="right">8.40</td>
<td align="right">17216.45</td>
<td align="right">7.90</td>
<td align="right">159906.62</td>
</tr>
<tr class="odd">
<td align="left">Supernatural</td>
<td align="right">58</td>
<td align="right">7.74</td>
<td align="right">8.36</td>
<td align="right">19662.47</td>
<td align="right">8.11</td>
<td align="right">269174.21</td>
</tr>
<tr class="even">
<td align="left">Drama</td>
<td align="right">54</td>
<td align="right">7.94</td>
<td align="right">8.41</td>
<td align="right">24999.26</td>
<td align="right">8.09</td>
<td align="right">279575.81</td>
</tr>
<tr class="odd">
<td align="left">Romance</td>
<td align="right">47</td>
<td align="right">7.40</td>
<td align="right">7.99</td>
<td align="right">11517.55</td>
<td align="right">7.76</td>
<td align="right">240592.87</td>
</tr>
<tr class="even">
<td align="left">Fantasy</td>
<td align="right">45</td>
<td align="right">7.76</td>
<td align="right">8.26</td>
<td align="right">21097.58</td>
<td align="right">8.11</td>
<td align="right">285569.42</td>
</tr>
<tr class="odd">
<td align="left">Sci-Fi</td>
<td align="right">33</td>
<td align="right">7.79</td>
<td align="right">7.93</td>
<td align="right">14952.12</td>
<td align="right">7.78</td>
<td align="right">216789.27</td>
</tr>
<tr class="even">
<td align="left">Seinen</td>
<td align="right">30</td>
<td align="right">7.37</td>
<td align="right">8.20</td>
<td align="right">11977.47</td>
<td align="right">7.66</td>
<td align="right">167865.30</td>
</tr>
<tr class="odd">
<td align="left">Mystery</td>
<td align="right">29</td>
<td align="right">7.90</td>
<td align="right">8.46</td>
<td align="right">17869.39</td>
<td align="right">8.02</td>
<td align="right">277079.72</td>
</tr>
<tr class="even">
<td align="left">Shounen</td>
<td align="right">25</td>
<td align="right">8.04</td>
<td align="right">8.75</td>
<td align="right">21719.50</td>
<td align="right">8.21</td>
<td align="right">338354.80</td>
</tr>
<tr class="odd">
<td align="left">Magic</td>
<td align="right">24</td>
<td align="right">7.42</td>
<td align="right">7.97</td>
<td align="right">14309.79</td>
<td align="right">7.95</td>
<td align="right">263051.46</td>
</tr>
<tr class="even">
<td align="left">Adventure</td>
<td align="right">20</td>
<td align="right">7.60</td>
<td align="right">8.48</td>
<td align="right">12175.30</td>
<td align="right">8.18</td>
<td align="right">346767.65</td>
</tr>
<tr class="odd">
<td align="left">Psychological</td>
<td align="right">20</td>
<td align="right">7.65</td>
<td align="right">8.21</td>
<td align="right">19453.47</td>
<td align="right">7.88</td>
<td align="right">315613.35</td>
</tr>
<tr class="even">
<td align="left">SuperPower</td>
<td align="right">17</td>
<td align="right">8.24</td>
<td align="right">8.42</td>
<td align="right">25527.41</td>
<td align="right">8.19</td>
<td align="right">400225.71</td>
</tr>
<tr class="odd">
<td align="left">Parody</td>
<td align="right">16</td>
<td align="right">7.69</td>
<td align="right">8.05</td>
<td align="right">9403.25</td>
<td align="right">7.61</td>
<td align="right">183292.19</td>
</tr>
<tr class="even">
<td align="left">Military</td>
<td align="right">12</td>
<td align="right">8.25</td>
<td align="right">8.36</td>
<td align="right">29216.67</td>
<td align="right">8.11</td>
<td align="right">403922.33</td>
</tr>
<tr class="odd">
<td align="left">Ecchi</td>
<td align="right">11</td>
<td align="right">6.82</td>
<td align="right">7.67</td>
<td align="right">8229.73</td>
<td align="right">7.63</td>
<td align="right">247873.27</td>
</tr>
<tr class="even">
<td align="left">Horror</td>
<td align="right">10</td>
<td align="right">7.00</td>
<td align="right">7.64</td>
<td align="right">15405.70</td>
<td align="right">7.48</td>
<td align="right">266667.10</td>
</tr>
<tr class="odd">
<td align="left">Mecha</td>
<td align="right">10</td>
<td align="right">7.40</td>
<td align="right">7.35</td>
<td align="right">19267.20</td>
<td align="right">7.50</td>
<td align="right">246206.90</td>
</tr>
<tr class="even">
<td align="left">Game</td>
<td align="right">9</td>
<td align="right">7.44</td>
<td align="right">7.73</td>
<td align="right">9294.67</td>
<td align="right">7.77</td>
<td align="right">389259.67</td>
</tr>
<tr class="odd">
<td align="left">Harem</td>
<td align="right">7</td>
<td align="right">6.57</td>
<td align="right">7.20</td>
<td align="right">5682.29</td>
<td align="right">7.24</td>
<td align="right">154537.57</td>
</tr>
<tr class="even">
<td align="left">Historical</td>
<td align="right">7</td>
<td align="right">8.14</td>
<td align="right">8.81</td>
<td align="right">7680.57</td>
<td align="right">8.28</td>
<td align="right">89261.43</td>
</tr>
<tr class="odd">
<td align="left">Music</td>
<td align="right">7</td>
<td align="right">7.00</td>
<td align="right">7.97</td>
<td align="right">12224.00</td>
<td align="right">7.89</td>
<td align="right">186041.71</td>
</tr>
<tr class="even">
<td align="left">Shoujo</td>
<td align="right">6</td>
<td align="right">9.00</td>
<td align="right">9.45</td>
<td align="right">52054.00</td>
<td align="right">8.61</td>
<td align="right">69487.67</td>
</tr>
<tr class="odd">
<td align="left">Thriller</td>
<td align="right">6</td>
<td align="right">8.83</td>
<td align="right">8.78</td>
<td align="right">23380.00</td>
<td align="right">8.50</td>
<td align="right">486415.83</td>
</tr>
<tr class="even">
<td align="left">Space</td>
<td align="right">5</td>
<td align="right">7.00</td>
<td align="right">7.04</td>
<td align="right">1733.00</td>
<td align="right">7.00</td>
<td align="right">35079.80</td>
</tr>
<tr class="odd">
<td align="left">Police</td>
<td align="right">3</td>
<td align="right">8.67</td>
<td align="right">8.40</td>
<td align="right">18267.00</td>
<td align="right">8.20</td>
<td align="right">588147.67</td>
</tr>
<tr class="even">
<td align="left">Dementia</td>
<td align="right">2</td>
<td align="right">7.50</td>
<td align="right">8.45</td>
<td align="right">37566.50</td>
<td align="right">7.83</td>
<td align="right">233431.00</td>
</tr>
<tr class="odd">
<td align="left">Josei</td>
<td align="right">2</td>
<td align="right">9.00</td>
<td align="right">9.45</td>
<td align="right">8624.00</td>
<td align="right">8.73</td>
<td align="right">44417.50</td>
</tr>
<tr class="even">
<td align="left">Shoujo Ai</td>
<td align="right">2</td>
<td align="right">7.00</td>
<td align="right">7.70</td>
<td align="right">3674.50</td>
<td align="right">7.07</td>
<td align="right">40518.50</td>
</tr>
<tr class="odd">
<td align="left">Sports</td>
<td align="right">2</td>
<td align="right">7.50</td>
<td align="right">8.90</td>
<td align="right">8259.50</td>
<td align="right">7.83</td>
<td align="right">52953.00</td>
</tr>
<tr class="even">
<td align="left">Vampire</td>
<td align="right">2</td>
<td align="right">7.50</td>
<td align="right">8.85</td>
<td align="right">13636.50</td>
<td align="right">8.56</td>
<td align="right">296321.00</td>
</tr>
</tbody>
</table>
<p>我看的最多的几个类别的喜剧（Comedy）、动作（Action）、校园（School）、日常（Slice of Life）和超自然（Super Natural），但我评分最高的几个类别是军事（Military）、超能力（Super Power）和少年（Shounen）（仅统计个数超过 10的），如果不统计一下的话，我自己都不知道。另外，我最不喜欢的是后宫（Harem）。记得有次跟hj师妹聊番剧，我说我最喜欢的是《凉宫春日的忧郁》，她（似乎很鄙夷地）跟我说，她不喜欢这种男性向的后宫番。首先，我想说，《凉宫》不是后宫番啊；其次，我也很讨厌后宫番啊！</p>
<p>计划将这一变量转换成稀疏矩阵，并去掉个数出现太少的类别。</p>
</div>
<div id="b8." class="section level3">
<h3>b8.制作公司</h3>
<p>我看的番剧共涉及到将近50个制作公司，还是先看一下整体的情况：</p>
<pre class="r"><code>anime %&gt;%  
  group_by(studio) %&gt;% 
  my_awesome_summary() %&gt;% 
  arrange(-N) %&gt;% 
  knitr::kable(digits = 2)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">studio</th>
<th align="right">N</th>
<th align="right">rating</th>
<th align="right">db_rating</th>
<th align="right">db_number</th>
<th align="right">mal_rating</th>
<th align="right">mal_number</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">A-1 Pictures</td>
<td align="right">16</td>
<td align="right">7.31</td>
<td align="right">7.71</td>
<td align="right">15227.56</td>
<td align="right">7.81</td>
<td align="right">317868.50</td>
</tr>
<tr class="even">
<td align="left">J.C. Staff</td>
<td align="right">15</td>
<td align="right">7.27</td>
<td align="right">7.87</td>
<td align="right">11284.93</td>
<td align="right">7.68</td>
<td align="right">140272.27</td>
</tr>
<tr class="odd">
<td align="left">Kyoto Animation</td>
<td align="right">13</td>
<td align="right">8.38</td>
<td align="right">8.63</td>
<td align="right">17731.00</td>
<td align="right">8.04</td>
<td align="right">259475.31</td>
</tr>
<tr class="even">
<td align="left">Studio Deen</td>
<td align="right">12</td>
<td align="right">7.25</td>
<td align="right">8.17</td>
<td align="right">10774.08</td>
<td align="right">7.84</td>
<td align="right">135950.00</td>
</tr>
<tr class="odd">
<td align="left">Mad house</td>
<td align="right">8</td>
<td align="right">8.38</td>
<td align="right">8.46</td>
<td align="right">14708.00</td>
<td align="right">8.30</td>
<td align="right">442931.00</td>
</tr>
<tr class="even">
<td align="left">Shaft</td>
<td align="right">8</td>
<td align="right">7.38</td>
<td align="right">8.43</td>
<td align="right">12112.88</td>
<td align="right">7.99</td>
<td align="right">202859.38</td>
</tr>
<tr class="odd">
<td align="left">Bones</td>
<td align="right">7</td>
<td align="right">8.86</td>
<td align="right">9.31</td>
<td align="right">30097.43</td>
<td align="right">8.68</td>
<td align="right">474203.29</td>
</tr>
<tr class="even">
<td align="left">Brain’s Base</td>
<td align="right">7</td>
<td align="right">8.43</td>
<td align="right">9.06</td>
<td align="right">45882.00</td>
<td align="right">8.45</td>
<td align="right">184809.14</td>
</tr>
<tr class="odd">
<td align="left">Sunrise</td>
<td align="right">7</td>
<td align="right">7.86</td>
<td align="right">8.23</td>
<td align="right">20527.71</td>
<td align="right">8.08</td>
<td align="right">293667.14</td>
</tr>
<tr class="even">
<td align="left">Production I.G</td>
<td align="right">6</td>
<td align="right">7.67</td>
<td align="right">8.30</td>
<td align="right">14079.50</td>
<td align="right">7.86</td>
<td align="right">166226.17</td>
</tr>
<tr class="odd">
<td align="left">White Fox</td>
<td align="right">6</td>
<td align="right">8.33</td>
<td align="right">8.53</td>
<td align="right">13787.50</td>
<td align="right">8.26</td>
<td align="right">266070.67</td>
</tr>
<tr class="even">
<td align="left">Lerche</td>
<td align="right">5</td>
<td align="right">7.20</td>
<td align="right">7.86</td>
<td align="right">8175.40</td>
<td align="right">7.78</td>
<td align="right">184249.20</td>
</tr>
<tr class="odd">
<td align="left">Shuka</td>
<td align="right">5</td>
<td align="right">8.40</td>
<td align="right">9.04</td>
<td align="right">13336.60</td>
<td align="right">8.34</td>
<td align="right">87420.00</td>
</tr>
<tr class="even">
<td align="left">SilverLink.</td>
<td align="right">5</td>
<td align="right">7.40</td>
<td align="right">8.44</td>
<td align="right">6791.80</td>
<td align="right">7.81</td>
<td align="right">149994.60</td>
</tr>
<tr class="odd">
<td align="left">ufotable</td>
<td align="right">5</td>
<td align="right">8.20</td>
<td align="right">8.84</td>
<td align="right">21870.60</td>
<td align="right">8.34</td>
<td align="right">271011.80</td>
</tr>
<tr class="even">
<td align="left">Wit Studio</td>
<td align="right">5</td>
<td align="right">8.20</td>
<td align="right">8.64</td>
<td align="right">34170.60</td>
<td align="right">8.05</td>
<td align="right">405481.40</td>
</tr>
<tr class="odd">
<td align="left">Doga Kobo</td>
<td align="right">4</td>
<td align="right">7.25</td>
<td align="right">7.97</td>
<td align="right">19771.00</td>
<td align="right">7.63</td>
<td align="right">132846.75</td>
</tr>
<tr class="even">
<td align="left">StudioPierrot</td>
<td align="right">4</td>
<td align="right">6.75</td>
<td align="right">7.32</td>
<td align="right">19858.75</td>
<td align="right">7.25</td>
<td align="right">385754.25</td>
</tr>
<tr class="odd">
<td align="left">AIC Build</td>
<td align="right">3</td>
<td align="right">7.33</td>
<td align="right">7.40</td>
<td align="right">8502.67</td>
<td align="right">7.42</td>
<td align="right">251730.00</td>
</tr>
<tr class="even">
<td align="left">Diomedea</td>
<td align="right">3</td>
<td align="right">7.00</td>
<td align="right">7.37</td>
<td align="right">3347.67</td>
<td align="right">7.22</td>
<td align="right">66933.67</td>
</tr>
<tr class="odd">
<td align="left">feel.</td>
<td align="right">3</td>
<td align="right">7.67</td>
<td align="right">8.77</td>
<td align="right">11638.67</td>
<td align="right">8.31</td>
<td align="right">155367.33</td>
</tr>
<tr class="even">
<td align="left">Gonzo</td>
<td align="right">3</td>
<td align="right">7.00</td>
<td align="right">7.33</td>
<td align="right">1005.67</td>
<td align="right">6.68</td>
<td align="right">7201.67</td>
</tr>
<tr class="odd">
<td align="left">Sate light</td>
<td align="right">3</td>
<td align="right">5.67</td>
<td align="right">5.73</td>
<td align="right">999.33</td>
<td align="right">6.83</td>
<td align="right">17787.33</td>
</tr>
<tr class="even">
<td align="left">Clover Works</td>
<td align="right">2</td>
<td align="right">6.00</td>
<td align="right">8.05</td>
<td align="right">8494.00</td>
<td align="right">7.62</td>
<td align="right">108598.50</td>
</tr>
<tr class="odd">
<td align="left">David Production</td>
<td align="right">2</td>
<td align="right">7.50</td>
<td align="right">8.95</td>
<td align="right">22642.50</td>
<td align="right">7.71</td>
<td align="right">44781.00</td>
</tr>
<tr class="even">
<td align="left">Geno Studio</td>
<td align="right">2</td>
<td align="right">7.50</td>
<td align="right">8.85</td>
<td align="right">1280.00</td>
<td align="right">7.97</td>
<td align="right">33665.00</td>
</tr>
<tr class="odd">
<td align="left">Kinema Citrus</td>
<td align="right">2</td>
<td align="right">8.00</td>
<td align="right">8.85</td>
<td align="right">6844.50</td>
<td align="right">8.39</td>
<td align="right">142476.00</td>
</tr>
<tr class="even">
<td align="left">Nomad</td>
<td align="right">2</td>
<td align="right">7.00</td>
<td align="right">7.85</td>
<td align="right">4552.00</td>
<td align="right">7.62</td>
<td align="right">63240.00</td>
</tr>
<tr class="odd">
<td align="left">P.A. Works</td>
<td align="right">2</td>
<td align="right">8.00</td>
<td align="right">8.65</td>
<td align="right">13699.50</td>
<td align="right">8.35</td>
<td align="right">400245.50</td>
</tr>
<tr class="even">
<td align="left">Seven</td>
<td align="right">2</td>
<td align="right">7.00</td>
<td align="right">8.10</td>
<td align="right">7988.50</td>
<td align="right">7.48</td>
<td align="right">94999.50</td>
</tr>
<tr class="odd">
<td align="left">Shin-Ei Animation</td>
<td align="right">2</td>
<td align="right">7.50</td>
<td align="right">8.70</td>
<td align="right">6996.50</td>
<td align="right">7.78</td>
<td align="right">73195.50</td>
</tr>
<tr class="even">
<td align="left">Xebec</td>
<td align="right">2</td>
<td align="right">7.00</td>
<td align="right">7.35</td>
<td align="right">2025.50</td>
<td align="right">7.28</td>
<td align="right">81748.50</td>
</tr>
<tr class="odd">
<td align="left">8bit</td>
<td align="right">1</td>
<td align="right">7.00</td>
<td align="right">8.10</td>
<td align="right">7069.00</td>
<td align="right">8.37</td>
<td align="right">78138.00</td>
</tr>
<tr class="even">
<td align="left">AIC</td>
<td align="right">1</td>
<td align="right">6.00</td>
<td align="right">6.70</td>
<td align="right">691.00</td>
<td align="right">7.44</td>
<td align="right">26658.00</td>
</tr>
<tr class="odd">
<td align="left">Arms</td>
<td align="right">1</td>
<td align="right">8.00</td>
<td align="right">8.20</td>
<td align="right">13862.00</td>
<td align="right">7.71</td>
<td align="right">562900.00</td>
</tr>
<tr class="even">
<td align="left">C-Station</td>
<td align="right">1</td>
<td align="right">7.00</td>
<td align="right">9.30</td>
<td align="right">3409.00</td>
<td align="right">8.33</td>
<td align="right">73442.00</td>
</tr>
<tr class="odd">
<td align="left">Gainax</td>
<td align="right">1</td>
<td align="right">8.00</td>
<td align="right">9.40</td>
<td align="right">69782.00</td>
<td align="right">8.33</td>
<td align="right">416593.00</td>
</tr>
<tr class="even">
<td align="left">Imagin</td>
<td align="right">1</td>
<td align="right">8.00</td>
<td align="right">8.10</td>
<td align="right">12540.00</td>
<td align="right">8.33</td>
<td align="right">249632.00</td>
</tr>
<tr class="odd">
<td align="left">Kamikaze Douga</td>
<td align="right">1</td>
<td align="right">7.00</td>
<td align="right">7.50</td>
<td align="right">5351.00</td>
<td align="right">7.33</td>
<td align="right">50269.00</td>
</tr>
<tr class="even">
<td align="left">Orange</td>
<td align="right">1</td>
<td align="right">8.00</td>
<td align="right">8.90</td>
<td align="right">17278.00</td>
<td align="right">8.46</td>
<td align="right">79433.00</td>
</tr>
<tr class="odd">
<td align="left">Pierrot Plus</td>
<td align="right">1</td>
<td align="right">7.00</td>
<td align="right">7.10</td>
<td align="right">1525.00</td>
<td align="right">6.71</td>
<td align="right">14046.00</td>
</tr>
<tr class="even">
<td align="left">Studio 3Hz</td>
<td align="right">1</td>
<td align="right">7.00</td>
<td align="right">7.40</td>
<td align="right">1648.00</td>
<td align="right">7.30</td>
<td align="right">101380.00</td>
</tr>
<tr class="odd">
<td align="left">Tatsunoko Production</td>
<td align="right">1</td>
<td align="right">8.00</td>
<td align="right">8.00</td>
<td align="right">9768.00</td>
<td align="right">7.52</td>
<td align="right">196840.00</td>
</tr>
<tr class="even">
<td align="left">TMS Entertainment</td>
<td align="right">1</td>
<td align="right">8.00</td>
<td align="right">8.80</td>
<td align="right">15681.00</td>
<td align="right">8.05</td>
<td align="right">99415.00</td>
</tr>
<tr class="odd">
<td align="left">TNK</td>
<td align="right">1</td>
<td align="right">6.00</td>
<td align="right">7.10</td>
<td align="right">15272.00</td>
<td align="right">5.95</td>
<td align="right">242096.00</td>
</tr>
<tr class="even">
<td align="left">Trigger</td>
<td align="right">1</td>
<td align="right">6.00</td>
<td align="right">6.80</td>
<td align="right">1352.00</td>
<td align="right">7.27</td>
<td align="right">115457.00</td>
</tr>
<tr class="odd">
<td align="left">TROYCA</td>
<td align="right">1</td>
<td align="right">7.00</td>
<td align="right">7.40</td>
<td align="right">5314.00</td>
<td align="right">7.46</td>
<td align="right">62885.00</td>
</tr>
</tbody>
</table>
<p>看的最多的三个制作公司分别是A-1，节操社（J.C. Staff）和京阿尼（Kyoto Animation），没想到我竟然看了那么多节操社的作品。为了更直观的对比，我选择个数超过5的11个公司，对评分进行了可视化：</p>
<pre class="r"><code>anime %&gt;%  
  group_by(studio) %&gt;% 
  my_awesome_summary() %&gt;% 
  filter(N &gt; 5) %&gt;% 
  gather(rater, score, c(&#39;rating&#39;, &#39;db_rating&#39;, &#39;mal_rating&#39;)) %&gt;% 
  select(studio, rater, score) %&gt;% 
  ggplot(aes(studio, score, fill = rater)) + 
  geom_col(aes(group = rater), position = &#39;dodge&#39;) + 
  scale_x_discrete(labels = c(&#39;A-1\nPictures&#39;, &#39;Bones&#39;, &quot;Brain&#39;s\nBase&quot;, &#39;J.C.\nStaff&#39;,
                              &#39;Kyoto\nAnimation&#39;, &#39;Mad\nhouse&#39;, &#39;Production\nI.G&#39;,
                              &#39;Shaft&#39;, &#39;Studio\nDeen&#39;, &#39;Sunrise&#39;, &#39;White\nFox&#39;)) + 
  scale_y_continuous(breaks = 1:10, labels = 1:10) + 
  coord_cartesian(ylim = 1:10) + 
  scale_fill_manual(values = c(&#39;#009E73&#39;, &#39;#E69F00&#39;, &#39;#56B4E9&#39;),
                    labels = c(&#39;豆瓣评分&#39;, &#39;MAL评分&#39;, &#39;个人评分&#39;)) + 
  labs(x = &#39;&#39;, y = &#39;&#39;, fill = &#39;&#39;) + 
  theme_tufte() + 
  theme(legend.position = &#39;top&#39;)</code></pre>
<p><img src="/post/2019-05-12-anime-recommend-with-ml_files/figure-html/unnamed-chunk-16-1.png" width="2100" /></p>
<p>可以看到，骨头社（Bones）的评价是最高的，而节操社的评价是最低的。如果某个番剧是骨头社、京阿尼、疯房子（Mad House）或者白狐社（White Fox）制作的，我基本上就可以放心的观看了（我对这几个公司的评分都要高于MAL上的评分）。</p>
<p>同上，也计划将这一变量转换成稀疏矩阵，并去掉个数出现太少的制作公司。</p>
</div>
<div id="b9." class="section level3">
<h3>b9.评分及人数</h3>
<p>3个评分变量和2个人数变量都是数值型，其中我的个人评分是反应变量，就是最终想通过模型预测的变量，而另外4个变量之间会有较高的相关，考虑只使用其中1个变量。先看一下相关的情况：</p>
<pre class="r"><code>corrplot(cor(anime[, 10:14], use = &#39;complete.obs&#39;), 
         method = &#39;number&#39;, type = &#39;upper&#39;)</code></pre>
<p><img src="/post/2019-05-12-anime-recommend-with-ml_files/figure-html/unnamed-chunk-17-1.png" width="2100" /></p>
<p>3个评分之间都由很高的相关，鉴于此，计划只使用豆瓣评分和MAL评分其中之一作为预测变量。在后面建模的时候，发现用豆瓣评分建立的模型不如使用MAL评分建立的模型要好，因此就只使用MAL的评分了，将其评分的中位数设为节点，大于中位数的视为推荐，小于中位数的视为不推荐。至于评分人数，跟我的评分相关也不低，但都低于相应的评分与我的评分之间的相关，因此就不使用了。对于我的评分，这次先处理为二元分类变量，将5-7分设为“不推荐”，而将8-10分设为“推荐”，作为反应变量的标签。</p>
</div>
<div id="extra-1.mal" class="section level3">
<h3>extra 1.个人、豆瓣与MAL的对比</h3>
<p>虽然我个人的评分于豆瓣评分、MAL评分都有很高的相关，但还是有一定的差异的。首先来看看我心中最好的番剧（即我评为10分的番剧）和豆瓣上、MAL上最好的番剧有什么不同：</p>
<pre class="r"><code>anime %&gt;% filter(rating == 10) %&gt;% 
  select(name, rating) %&gt;% 
  bind_cols(anime %&gt;% arrange(-db_rating) %&gt;% 
              select(db_name = name, db_rating) %&gt;% slice(1:10)) %&gt;% 
  bind_cols(anime %&gt;% arrange(-mal_rating) %&gt;% 
              select(mal_name = name, mal_rating) %&gt;% slice(1:10)) %&gt;% 
  knitr::kable(digits = 2)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">name</th>
<th align="right">rating</th>
<th align="left">db_name</th>
<th align="right">db_rating</th>
<th align="left">mal_name</th>
<th align="right">mal_rating</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">凉宫春日的忧郁</td>
<td align="right">10</td>
<td align="left">灵能百分百Ⅱ</td>
<td align="right">9.7</td>
<td align="left">钢之炼金术师FA</td>
<td align="right">9.24</td>
</tr>
<tr class="even">
<td align="left">反叛的鲁路修</td>
<td align="right">10</td>
<td align="left">钢之炼金术师FA</td>
<td align="right">9.6</td>
<td align="left">命运石之门</td>
<td align="right">9.13</td>
</tr>
<tr class="odd">
<td align="left">死亡笔记</td>
<td align="right">10</td>
<td align="left">夏目友人帐第三季</td>
<td align="right">9.5</td>
<td align="left">灵能百分百Ⅱ</td>
<td align="right">9.00</td>
</tr>
<tr class="even">
<td align="left">团子大家族</td>
<td align="right">10</td>
<td align="left">夏目友人帐第四季</td>
<td align="right">9.5</td>
<td align="left">团子大家族 第二季</td>
<td align="right">8.99</td>
</tr>
<tr class="odd">
<td align="left">反叛的鲁路修 R2</td>
<td align="right">10</td>
<td align="left">夏目友人帐第五季</td>
<td align="right">9.5</td>
<td align="left">反叛的鲁路修 R2</td>
<td align="right">8.94</td>
</tr>
<tr class="even">
<td align="left">团子大家族 第二季</td>
<td align="right">10</td>
<td align="left">昭和元禄落语心中助六再临篇</td>
<td align="right">9.5</td>
<td align="left">来自深渊</td>
<td align="right">8.87</td>
</tr>
<tr class="odd">
<td align="left">钢之炼金术师FA</td>
<td align="right">10</td>
<td align="left">夏目友人帐第六季</td>
<td align="right">9.5</td>
<td align="left">四月是你的谎言</td>
<td align="right">8.86</td>
</tr>
<tr class="even">
<td align="left">凉宫春日的忧郁 2009</td>
<td align="right">10</td>
<td align="left">进击的巨人第三季1</td>
<td align="right">9.5</td>
<td align="left">昭和元禄落语心中助六再临篇</td>
<td align="right">8.84</td>
</tr>
<tr class="odd">
<td align="left">命运石之门</td>
<td align="right">10</td>
<td align="left">新世纪福音战士</td>
<td align="right">9.4</td>
<td align="left">反叛的鲁路修</td>
<td align="right">8.77</td>
</tr>
<tr class="even">
<td align="left">一拳超人</td>
<td align="right">10</td>
<td align="left">夏目友人帐 第二季</td>
<td align="right">9.4</td>
<td align="left">物语系列第二季</td>
<td align="right">8.77</td>
</tr>
</tbody>
</table>
<p>可以看到，豆瓣上几乎是夏目的天下，跟我只重了钢炼FA一个。灵能2我也很喜欢，但感觉还是跟一拳超人差了一个档次。我的十佳跟MAL的十佳有5个重叠，对于物语系列能排到前10，甚感意外。</p>
<p>再来看看评分的整体分布：</p>
<pre class="r"><code>anime %&gt;% gather(rating, value, c(&#39;rating&#39;, &#39;db_rating&#39;, &#39;mal_rating&#39;)) %&gt;% 
  select(rating, value) %&gt;% 
  ggplot(aes(value, fill = rating)) + 
  geom_density(alpha = .8) +
  scale_x_continuous(breaks = 4:10, labels = 4:10) + 
  scale_fill_manual(values = c(&#39;#009E73&#39;, &#39;#E69F00&#39;, &#39;#56B4E9&#39;),
                    labels = c(&#39;豆瓣评分&#39;, &#39;MAL评分&#39;, &#39;个人评分&#39;)) + 
  labs(x = &#39;&#39;, y = &#39;&#39;, fill = &#39;&#39;) + 
  theme_tufte() + 
  theme(legend.position = &#39;top&#39;)</code></pre>
<p><img src="/post/2019-05-12-anime-recommend-with-ml_files/figure-html/unnamed-chunk-19-1.png" width="2100" /></p>
<p>我的评分大部分都是7分或8分，7分就是那种看不看两可的感觉，而8分就是很值得一看了。MAL上的评分集中在7分和9分之间，很少有能在MAL上拿到9分以上的番剧；而豆瓣上的评分则稍微分散一些，峰值出现在9分左右，看来豆瓣上的用户倾向于给出高分，但这也是因为豆瓣上给番剧评分的用户远少于MAL上的用户：</p>
<pre class="r"><code>anime %&gt;% gather(number, value, c(&#39;db_number&#39;, &#39;mal_number&#39;)) %&gt;% 
  select(number, value) %&gt;% 
  ggplot(aes(value, fill = number)) + 
  geom_histogram(show.legend = FALSE) +
  scale_x_continuous(labels = scales::comma) + 
  scale_fill_manual(values = c(&#39;#009E73&#39;, &#39;#E69F00&#39;)) + 
  labs(x = &#39;&#39;, y = &#39;&#39;, fill = &#39;&#39;) + 
  facet_wrap(~ number, nrow = 2, scales = &#39;free&#39;,
             labeller = as_labeller(c(&#39;db_number&#39; = &#39;豆瓣人数&#39;, 
                                      &#39;mal_number&#39; = &#39;MAL人数&#39;))) + 
  theme_tufte() + 
  theme(legend.position = &#39;top&#39;)</code></pre>
<p><img src="/post/2019-05-12-anime-recommend-with-ml_files/figure-html/unnamed-chunk-20-1.png" width="2100" /></p>
<p>但从趋势上来看，还是差不多的。</p>
</div>
<div id="b0." class="section level3">
<h3>b0.声优</h3>
<p>最后一个变量是声优。虽然只收集了不到200个番剧，但声优数却有600多。先看一下主要声优的情况（仅统计参演超过10部的声优）：</p>
<pre class="r"><code>anime %&gt;% separate_rows(cast, sep = &#39;/&#39;) %&gt;% 
  group_by(cast) %&gt;% 
  my_awesome_summary() %&gt;% 
  filter(N &gt; 10) %&gt;% arrange(-rating) %&gt;% 
  knitr::kable(digits = 2)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">cast</th>
<th align="right">N</th>
<th align="right">rating</th>
<th align="right">db_rating</th>
<th align="right">db_number</th>
<th align="right">mal_rating</th>
<th align="right">mal_number</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">关智一</td>
<td align="right">12</td>
<td align="right">8.75</td>
<td align="right">9.06</td>
<td align="right">27225.92</td>
<td align="right">8.52</td>
<td align="right">326825.7</td>
</tr>
<tr class="even">
<td align="left">浪川大辅</td>
<td align="right">11</td>
<td align="right">8.45</td>
<td align="right">8.68</td>
<td align="right">25943.91</td>
<td align="right">8.28</td>
<td align="right">323097.7</td>
</tr>
<tr class="odd">
<td align="left">细谷佳正</td>
<td align="right">12</td>
<td align="right">8.42</td>
<td align="right">8.97</td>
<td align="right">27083.75</td>
<td align="right">8.27</td>
<td align="right">371816.4</td>
</tr>
<tr class="even">
<td align="left">大原沙耶香</td>
<td align="right">11</td>
<td align="right">8.36</td>
<td align="right">8.75</td>
<td align="right">21912.09</td>
<td align="right">8.33</td>
<td align="right">272202.0</td>
</tr>
<tr class="odd">
<td align="left">小林优</td>
<td align="right">13</td>
<td align="right">8.31</td>
<td align="right">8.69</td>
<td align="right">21555.23</td>
<td align="right">8.11</td>
<td align="right">237782.9</td>
</tr>
<tr class="even">
<td align="left">石田彰</td>
<td align="right">18</td>
<td align="right">8.28</td>
<td align="right">8.84</td>
<td align="right">35076.67</td>
<td align="right">8.27</td>
<td align="right">151272.8</td>
</tr>
<tr class="odd">
<td align="left">小山力也</td>
<td align="right">11</td>
<td align="right">8.09</td>
<td align="right">8.40</td>
<td align="right">20032.91</td>
<td align="right">7.87</td>
<td align="right">217325.6</td>
</tr>
<tr class="even">
<td align="left">三宅健太</td>
<td align="right">12</td>
<td align="right">8.08</td>
<td align="right">8.27</td>
<td align="right">20692.25</td>
<td align="right">8.04</td>
<td align="right">369599.2</td>
</tr>
<tr class="odd">
<td align="left">神谷浩史</td>
<td align="right">25</td>
<td align="right">8.08</td>
<td align="right">8.79</td>
<td align="right">27032.56</td>
<td align="right">8.27</td>
<td align="right">239633.2</td>
</tr>
<tr class="even">
<td align="left">小野大辅</td>
<td align="right">18</td>
<td align="right">8.00</td>
<td align="right">8.55</td>
<td align="right">20281.28</td>
<td align="right">7.89</td>
<td align="right">213190.6</td>
</tr>
<tr class="odd">
<td align="left">中村悠一</td>
<td align="right">22</td>
<td align="right">7.95</td>
<td align="right">8.14</td>
<td align="right">20212.82</td>
<td align="right">7.92</td>
<td align="right">298512.9</td>
</tr>
<tr class="even">
<td align="left">梶裕贵</td>
<td align="right">25</td>
<td align="right">7.92</td>
<td align="right">8.50</td>
<td align="right">20228.08</td>
<td align="right">8.10</td>
<td align="right">323644.1</td>
</tr>
<tr class="odd">
<td align="left">樱井孝宏</td>
<td align="right">20</td>
<td align="right">7.90</td>
<td align="right">8.48</td>
<td align="right">22061.85</td>
<td align="right">8.14</td>
<td align="right">319606.4</td>
</tr>
<tr class="even">
<td align="left">中田让治</td>
<td align="right">13</td>
<td align="right">7.85</td>
<td align="right">8.35</td>
<td align="right">17024.69</td>
<td align="right">7.96</td>
<td align="right">229432.1</td>
</tr>
<tr class="odd">
<td align="left">诹访部顺一</td>
<td align="right">13</td>
<td align="right">7.85</td>
<td align="right">8.24</td>
<td align="right">17122.31</td>
<td align="right">7.84</td>
<td align="right">163293.1</td>
</tr>
<tr class="even">
<td align="left">井上麻里奈</td>
<td align="right">16</td>
<td align="right">7.81</td>
<td align="right">8.47</td>
<td align="right">17329.00</td>
<td align="right">7.96</td>
<td align="right">317493.6</td>
</tr>
<tr class="odd">
<td align="left">宫野真守</td>
<td align="right">21</td>
<td align="right">7.76</td>
<td align="right">8.31</td>
<td align="right">16738.55</td>
<td align="right">8.01</td>
<td align="right">338401.7</td>
</tr>
<tr class="even">
<td align="left">田村由加莉</td>
<td align="right">12</td>
<td align="right">7.75</td>
<td align="right">8.16</td>
<td align="right">16199.75</td>
<td align="right">7.83</td>
<td align="right">248854.1</td>
</tr>
<tr class="odd">
<td align="left">植田佳奈</td>
<td align="right">12</td>
<td align="right">7.75</td>
<td align="right">8.51</td>
<td align="right">18014.50</td>
<td align="right">8.05</td>
<td align="right">239926.1</td>
</tr>
<tr class="even">
<td align="left">福山润</td>
<td align="right">19</td>
<td align="right">7.74</td>
<td align="right">8.49</td>
<td align="right">16092.37</td>
<td align="right">8.13</td>
<td align="right">253515.6</td>
</tr>
<tr class="odd">
<td align="left">佐仓绫音</td>
<td align="right">19</td>
<td align="right">7.74</td>
<td align="right">8.18</td>
<td align="right">10453.89</td>
<td align="right">7.87</td>
<td align="right">194947.5</td>
</tr>
<tr class="even">
<td align="left">泽城美雪</td>
<td align="right">25</td>
<td align="right">7.72</td>
<td align="right">8.35</td>
<td align="right">18715.68</td>
<td align="right">8.01</td>
<td align="right">211165.4</td>
</tr>
<tr class="odd">
<td align="left">新井里美</td>
<td align="right">14</td>
<td align="right">7.71</td>
<td align="right">7.91</td>
<td align="right">13257.64</td>
<td align="right">7.70</td>
<td align="right">209135.7</td>
</tr>
<tr class="even">
<td align="left">花泽香菜</td>
<td align="right">25</td>
<td align="right">7.68</td>
<td align="right">8.26</td>
<td align="right">15851.72</td>
<td align="right">8.00</td>
<td align="right">261241.5</td>
</tr>
<tr class="odd">
<td align="left">伊藤静</td>
<td align="right">12</td>
<td align="right">7.67</td>
<td align="right">8.38</td>
<td align="right">13296.50</td>
<td align="right">7.96</td>
<td align="right">171365.3</td>
</tr>
<tr class="even">
<td align="left">早见沙织</td>
<td align="right">14</td>
<td align="right">7.64</td>
<td align="right">8.24</td>
<td align="right">20426.71</td>
<td align="right">8.10</td>
<td align="right">267863.5</td>
</tr>
<tr class="odd">
<td align="left">川澄绫子</td>
<td align="right">11</td>
<td align="right">7.64</td>
<td align="right">8.29</td>
<td align="right">18295.00</td>
<td align="right">7.93</td>
<td align="right">196957.9</td>
</tr>
<tr class="even">
<td align="left">木村良平</td>
<td align="right">11</td>
<td align="right">7.64</td>
<td align="right">8.31</td>
<td align="right">19371.82</td>
<td align="right">8.11</td>
<td align="right">210926.9</td>
</tr>
<tr class="odd">
<td align="left">下野纮</td>
<td align="right">11</td>
<td align="right">7.64</td>
<td align="right">8.13</td>
<td align="right">17083.45</td>
<td align="right">7.87</td>
<td align="right">239582.9</td>
</tr>
<tr class="even">
<td align="left">悠木碧</td>
<td align="right">16</td>
<td align="right">7.62</td>
<td align="right">8.45</td>
<td align="right">16303.12</td>
<td align="right">8.07</td>
<td align="right">357969.2</td>
</tr>
<tr class="odd">
<td align="left">喜多村英梨</td>
<td align="right">13</td>
<td align="right">7.62</td>
<td align="right">8.49</td>
<td align="right">14083.85</td>
<td align="right">8.18</td>
<td align="right">339427.3</td>
</tr>
<tr class="even">
<td align="left">加藤英美里</td>
<td align="right">12</td>
<td align="right">7.58</td>
<td align="right">8.04</td>
<td align="right">11545.83</td>
<td align="right">8.06</td>
<td align="right">244129.2</td>
</tr>
<tr class="odd">
<td align="left">松冈祯丞</td>
<td align="right">12</td>
<td align="right">7.58</td>
<td align="right">8.25</td>
<td align="right">15437.83</td>
<td align="right">8.01</td>
<td align="right">339119.0</td>
</tr>
<tr class="even">
<td align="left">逢坂良太</td>
<td align="right">11</td>
<td align="right">7.55</td>
<td align="right">7.84</td>
<td align="right">17280.18</td>
<td align="right">7.86</td>
<td align="right">277002.1</td>
</tr>
<tr class="odd">
<td align="left">冈本信彦</td>
<td align="right">15</td>
<td align="right">7.53</td>
<td align="right">8.19</td>
<td align="right">16826.20</td>
<td align="right">7.93</td>
<td align="right">228771.8</td>
</tr>
<tr class="even">
<td align="left">杉田智和</td>
<td align="right">21</td>
<td align="right">7.52</td>
<td align="right">8.23</td>
<td align="right">13374.81</td>
<td align="right">7.68</td>
<td align="right">149927.9</td>
</tr>
<tr class="odd">
<td align="left">能登麻美子</td>
<td align="right">18</td>
<td align="right">7.50</td>
<td align="right">7.94</td>
<td align="right">12636.78</td>
<td align="right">7.83</td>
<td align="right">197120.6</td>
</tr>
<tr class="even">
<td align="left">佐藤聪美</td>
<td align="right">12</td>
<td align="right">7.50</td>
<td align="right">8.22</td>
<td align="right">9852.75</td>
<td align="right">7.81</td>
<td align="right">166250.3</td>
</tr>
<tr class="odd">
<td align="left">钉宫理惠</td>
<td align="right">13</td>
<td align="right">7.46</td>
<td align="right">8.08</td>
<td align="right">16001.85</td>
<td align="right">7.80</td>
<td align="right">303504.1</td>
</tr>
<tr class="even">
<td align="left">日笠阳子</td>
<td align="right">11</td>
<td align="right">7.45</td>
<td align="right">8.40</td>
<td align="right">13392.18</td>
<td align="right">7.97</td>
<td align="right">206685.2</td>
</tr>
<tr class="odd">
<td align="left">堀江由衣</td>
<td align="right">11</td>
<td align="right">7.36</td>
<td align="right">8.32</td>
<td align="right">14453.00</td>
<td align="right">8.10</td>
<td align="right">281930.8</td>
</tr>
<tr class="even">
<td align="left">竹达彩奈</td>
<td align="right">11</td>
<td align="right">7.36</td>
<td align="right">7.89</td>
<td align="right">15388.18</td>
<td align="right">7.66</td>
<td align="right">340554.2</td>
</tr>
<tr class="odd">
<td align="left">石川界人</td>
<td align="right">14</td>
<td align="right">7.29</td>
<td align="right">7.66</td>
<td align="right">10563.36</td>
<td align="right">7.47</td>
<td align="right">205135.0</td>
</tr>
<tr class="even">
<td align="left">茅野爱衣</td>
<td align="right">14</td>
<td align="right">7.21</td>
<td align="right">8.05</td>
<td align="right">18157.86</td>
<td align="right">8.08</td>
<td align="right">270272.0</td>
</tr>
<tr class="odd">
<td align="left">井口裕香</td>
<td align="right">15</td>
<td align="right">7.07</td>
<td align="right">7.81</td>
<td align="right">8491.73</td>
<td align="right">7.87</td>
<td align="right">239696.8</td>
</tr>
</tbody>
</table>
<p>关智一以绝对的优势排在了第一名，看来只要有他出演，质量就可以得到保证。那看看他出演了哪些番剧吧：</p>
<pre class="r"><code>anime %&gt;% filter(str_detect(cast, &#39;关智一&#39;)) %&gt;% 
  select(name, rating, db_rating, db_number, mal_rating, mal_number) %&gt;% 
  knitr::kable(digits = 2)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">name</th>
<th align="right">rating</th>
<th align="right">db_rating</th>
<th align="right">db_number</th>
<th align="right">mal_rating</th>
<th align="right">mal_number</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">新世纪福音战士</td>
<td align="right">8</td>
<td align="right">9.4</td>
<td align="right">69782</td>
<td align="right">8.33</td>
<td align="right">416593</td>
</tr>
<tr class="even">
<td align="left">青之文学</td>
<td align="right">8</td>
<td align="right">8.7</td>
<td align="right">16481</td>
<td align="right">7.82</td>
<td align="right">40803</td>
</tr>
<tr class="odd">
<td align="left">命运石之门</td>
<td align="right">10</td>
<td align="right">9.3</td>
<td align="right">39302</td>
<td align="right">9.13</td>
<td align="right">653578</td>
</tr>
<tr class="even">
<td align="left">命运之夜前传</td>
<td align="right">9</td>
<td align="right">9.1</td>
<td align="right">38651</td>
<td align="right">8.42</td>
<td align="right">426719</td>
</tr>
<tr class="odd">
<td align="left">命运之夜前传第二期</td>
<td align="right">9</td>
<td align="right">9.1</td>
<td align="right">30630</td>
<td align="right">8.64</td>
<td align="right">356533</td>
</tr>
<tr class="even">
<td align="left">心理测量者</td>
<td align="right">8</td>
<td align="right">8.8</td>
<td align="right">26766</td>
<td align="right">8.43</td>
<td align="right">428052</td>
</tr>
<tr class="odd">
<td align="left">命运之夜 无限剑制</td>
<td align="right">8</td>
<td align="right">8.6</td>
<td align="right">20634</td>
<td align="right">8.31</td>
<td align="right">301393</td>
</tr>
<tr class="even">
<td align="left">命运之夜 无限剑制 第二季</td>
<td align="right">8</td>
<td align="right">8.3</td>
<td align="right">13787</td>
<td align="right">8.39</td>
<td align="right">254243</td>
</tr>
<tr class="odd">
<td align="left">一拳超人</td>
<td align="right">10</td>
<td align="right">9.3</td>
<td align="right">45526</td>
<td align="right">8.70</td>
<td align="right">836549</td>
</tr>
<tr class="even">
<td align="left">昭和元禄落语心中</td>
<td align="right">9</td>
<td align="right">9.4</td>
<td align="right">12574</td>
<td align="right">8.62</td>
<td align="right">55045</td>
</tr>
<tr class="odd">
<td align="left">昭和元禄落语心中助六再临篇</td>
<td align="right">9</td>
<td align="right">9.5</td>
<td align="right">4674</td>
<td align="right">8.84</td>
<td align="right">33790</td>
</tr>
<tr class="even">
<td align="left">命运石之门0</td>
<td align="right">9</td>
<td align="right">9.2</td>
<td align="right">7904</td>
<td align="right">8.59</td>
<td align="right">118610</td>
</tr>
</tbody>
</table>
<p>但我目前最喜欢的声优是神谷浩史，在我看的番剧中，他出现的次数也是最多的，来看看他的情况：</p>
<pre class="r"><code>anime %&gt;% filter(str_detect(cast, &#39;神谷浩史&#39;)) %&gt;% 
  select(name, rating, db_rating, db_number, mal_rating, mal_number) %&gt;% 
  knitr::kable(digits = 2)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">name</th>
<th align="right">rating</th>
<th align="right">db_rating</th>
<th align="right">db_number</th>
<th align="right">mal_rating</th>
<th align="right">mal_number</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">再见，绝望先生</td>
<td align="right">8</td>
<td align="right">8.5</td>
<td align="right">14684</td>
<td align="right">7.96</td>
<td align="right">93182</td>
</tr>
<tr class="even">
<td align="left">夏目友人帐</td>
<td align="right">9</td>
<td align="right">9.3</td>
<td align="right">106587</td>
<td align="right">8.38</td>
<td align="right">118354</td>
</tr>
<tr class="odd">
<td align="left">夏目友人帐 第二季</td>
<td align="right">9</td>
<td align="right">9.4</td>
<td align="right">64594</td>
<td align="right">8.61</td>
<td align="right">84469</td>
</tr>
<tr class="even">
<td align="left">化物语</td>
<td align="right">8</td>
<td align="right">8.6</td>
<td align="right">22429</td>
<td align="right">8.35</td>
<td align="right">403140</td>
</tr>
<tr class="odd">
<td align="left">无头骑士异闻录</td>
<td align="right">8</td>
<td align="right">8.7</td>
<td align="right">38140</td>
<td align="right">8.26</td>
<td align="right">412301</td>
</tr>
<tr class="even">
<td align="left">天使的心跳</td>
<td align="right">7</td>
<td align="right">7.9</td>
<td align="right">18793</td>
<td align="right">8.28</td>
<td align="right">714781</td>
</tr>
<tr class="odd">
<td align="left">夏目友人帐第三季</td>
<td align="right">9</td>
<td align="right">9.5</td>
<td align="right">51257</td>
<td align="right">8.64</td>
<td align="right">75891</td>
</tr>
<tr class="even">
<td align="left">伪物语</td>
<td align="right">7</td>
<td align="right">8.5</td>
<td align="right">9086</td>
<td align="right">8.20</td>
<td align="right">246841</td>
</tr>
<tr class="odd">
<td align="left">夏目友人帐第四季</td>
<td align="right">9</td>
<td align="right">9.5</td>
<td align="right">43673</td>
<td align="right">8.71</td>
<td align="right">68662</td>
</tr>
<tr class="even">
<td align="left">猫物语（黑）</td>
<td align="right">7</td>
<td align="right">8.6</td>
<td align="right">6007</td>
<td align="right">8.03</td>
<td align="right">183539</td>
</tr>
<tr class="odd">
<td align="left">进击的巨人</td>
<td align="right">9</td>
<td align="right">8.9</td>
<td align="right">97544</td>
<td align="right">8.47</td>
<td align="right">1078647</td>
</tr>
<tr class="even">
<td align="left">物语系列第二季</td>
<td align="right">7</td>
<td align="right">9.1</td>
<td align="right">4844</td>
<td align="right">8.77</td>
<td align="right">189502</td>
</tr>
<tr class="odd">
<td align="left">命运之夜 无限剑制</td>
<td align="right">8</td>
<td align="right">8.6</td>
<td align="right">20634</td>
<td align="right">8.31</td>
<td align="right">301393</td>
</tr>
<tr class="even">
<td align="left">七大罪</td>
<td align="right">7</td>
<td align="right">8.4</td>
<td align="right">7072</td>
<td align="right">8.23</td>
<td align="right">497232</td>
</tr>
<tr class="odd">
<td align="left">无头骑士异闻录 承</td>
<td align="right">8</td>
<td align="right">8.8</td>
<td align="right">9448</td>
<td align="right">8.09</td>
<td align="right">151912</td>
</tr>
<tr class="even">
<td align="left">命运之夜 无限剑制 第二季</td>
<td align="right">8</td>
<td align="right">8.3</td>
<td align="right">13787</td>
<td align="right">8.39</td>
<td align="right">254243</td>
</tr>
<tr class="odd">
<td align="left">那就是声优</td>
<td align="right">7</td>
<td align="right">7.2</td>
<td align="right">1290</td>
<td align="right">7.08</td>
<td align="right">13365</td>
</tr>
<tr class="even">
<td align="left">无头骑士异闻录 转</td>
<td align="right">8</td>
<td align="right">8.7</td>
<td align="right">5982</td>
<td align="right">8.08</td>
<td align="right">115729</td>
</tr>
<tr class="odd">
<td align="left">进击！巨人中学校</td>
<td align="right">7</td>
<td align="right">7.5</td>
<td align="right">1283</td>
<td align="right">7.06</td>
<td align="right">45391</td>
</tr>
<tr class="even">
<td align="left">无头骑士异闻录 结</td>
<td align="right">8</td>
<td align="right">8.7</td>
<td align="right">5040</td>
<td align="right">8.17</td>
<td align="right">99909</td>
</tr>
<tr class="odd">
<td align="left">齐木楠雄的灾难</td>
<td align="right">8</td>
<td align="right">9.3</td>
<td align="right">37064</td>
<td align="right">8.55</td>
<td align="right">109573</td>
</tr>
<tr class="even">
<td align="left">夏目友人帐第五季</td>
<td align="right">9</td>
<td align="right">9.5</td>
<td align="right">26317</td>
<td align="right">8.63</td>
<td align="right">38075</td>
</tr>
<tr class="odd">
<td align="left">进击的巨人第二季</td>
<td align="right">9</td>
<td align="right">9.2</td>
<td align="right">31939</td>
<td align="right">8.43</td>
<td align="right">471478</td>
</tr>
<tr class="even">
<td align="left">夏目友人帐第六季</td>
<td align="right">9</td>
<td align="right">9.5</td>
<td align="right">19896</td>
<td align="right">8.71</td>
<td align="right">31475</td>
</tr>
<tr class="odd">
<td align="left">进击的巨人第三季1</td>
<td align="right">9</td>
<td align="right">9.5</td>
<td align="right">18424</td>
<td align="right">8.47</td>
<td align="right">191745</td>
</tr>
</tbody>
</table>
<p>卡米亚真是出演了不少热门番剧。</p>
<p>这一变量也是转换成稀疏矩阵，并去掉出现次数太少的声优。</p>
</div>
<div id="extra-2." class="section level3">
<h3>extra 2.声优关系网络</h3>
<p>这种图挺难画好看的，花了不少时间来调整：</p>
<pre class="r"><code>anime %&gt;% separate_rows(cast, sep = &#39;/&#39;) %&gt;% 
  group_by(name) %&gt;% 
  mutate(linenumber = group_indices()) %&gt;% 
  pairwise_count(cast, linenumber) %&gt;% 
  group_by(item1, item2) %&gt;% 
  count(sort = TRUE) %&gt;% 
  ungroup() %&gt;% 
  filter(n &gt; 4) %&gt;% 
  graph_from_data_frame() %&gt;% 
  ggraph(layout = &quot;fr&quot;) + 
  geom_edge_link(aes(alpha = n, width = n), color = &#39;grey50&#39;) +
  scale_edge_width(range = c(.5, 2)) +
  geom_node_point(color = &#39;#D55E00&#39;, size = 4) +
  geom_node_text(aes(label = name), size = 2, color = &#39;black&#39;) + 
  theme_void() + 
  theme(legend.position = &#39;&#39;)</code></pre>
<p><img src="/post/2019-05-12-anime-recommend-with-ml_files/figure-html/unnamed-chunk-24-1.png" width="2100" /></p>
<p>仔细看的话，可以看到不少有意思的地方，但这不是主题，略过。</p>
</div>
</div>
<div id="c." class="section level1">
<h1>C.建模与评估</h1>
<p>数据都探索完了，接下来就可以建立模型，进行分类了。</p>
<div id="c1." class="section level3">
<h3>c1.清洗数据</h3>
<p>不过首先还是应该对数据进行清洗，需要清洗的地方前面以前都提到了：</p>
<pre class="r"><code>anime_clean &lt;- anime %&gt;%   
  mutate(season_more = ifelse(series %in% (anime %&gt;% filter(season_number &gt; 1) %&gt;% 
                                             pull(series) %&gt;% unique()), 1, 0),
         lengthy = ifelse(episode &gt; 20, 1, 0),
         old = ifelse(year &lt; 2015, 1, 0),
         mal_recommand = ifelse(mal_rating &gt; median(mal_rating), 1, 0),
         recommend = ifelse(rating &gt; 7, 1, 0),
         recommend = factor(recommend, levels = c(1, 0), 
                            labels = c(&#39;recommend&#39;, &#39;not recommend&#39;))) %&gt;% 
  bind_cols(anime %&gt;% mutate(row = row_number()) %&gt;% 
              separate_rows(genra, sep = &#39;,&#39;) %&gt;% 
              cast_sparse(row, genra) %&gt;% 
              as.matrix() %&gt;% 
              as_tibble() %&gt;% 
              select(which(colSums(.) &gt; 9)),
            anime %&gt;% mutate(row = row_number()) %&gt;% 
              cast_sparse(row, studio) %&gt;% 
              as.matrix() %&gt;% 
              as_tibble() %&gt;% 
              select(which(colSums(.) &gt; 4)),
            anime %&gt;% mutate(row = row_number()) %&gt;% 
              separate_rows(cast, sep = &#39;/&#39;) %&gt;% 
              cast_sparse(row, cast) %&gt;% 
              as.matrix() %&gt;% 
              as_tibble() %&gt;% 
              select(which(colSums(.) &gt; 4))) %&gt;% 
  select(recommend, everything()) %&gt;% 
  select(-3:-16) %&gt;% 
  mutate_if(is.numeric, factor, levels = c(0, 1), labels = c(&#39;No&#39;, &#39;Yes&#39;))</code></pre>
<p>这大概是我接触R以来写的最长的一段数据清洗的代码了，<code>tidyverse</code>化的R代码，真是越看越好看。现在的数据共有182个变量：</p>
<pre class="r"><code>dim(anime_clean)</code></pre>
<pre><code>## [1] 186 182</code></pre>
</div>
<div id="c2." class="section level3">
<h3>c2.创建训练数据集和测试数据集</h3>
<p>然后将数据分为训练集和测试集，训练集包括124行数据，测试集包括剩余的62行数据：</p>
<pre class="r"><code>set.seed(0509)
anime_train &lt;- anime_clean %&gt;% sample_n(124)
anime_test &lt;- anime_clean %&gt;% setdiff(anime_train)</code></pre>
</div>
<div id="c3." class="section level3">
<h3>c3.朴素贝叶斯算法</h3>
<p>先试试朴素贝叶斯算法：</p>
<pre class="r"><code>anime_class &lt;- naiveBayes(anime_train[, -1], anime_train$recommend)
anime_pred &lt;- predict(anime_class, anime_test[, -1])

CrossTable(anime_pred, anime_test$recommend, prop.chisq = FALSE, 
           dnn = c(&#39;predicted&#39;, &#39;actual&#39;))</code></pre>
<pre><code>## 
##  
##    Cell Contents
## |-------------------------|
## |                       N |
## |           N / Row Total |
## |           N / Col Total |
## |         N / Table Total |
## |-------------------------|
## 
##  
## Total Observations in Table:  62 
## 
##  
##               | actual 
##     predicted |     recommend | not recommend |     Row Total | 
## --------------|---------------|---------------|---------------|
##     recommend |            28 |             3 |            31 | 
##               |         0.903 |         0.097 |         0.500 | 
##               |         0.800 |         0.111 |               | 
##               |         0.452 |         0.048 |               | 
## --------------|---------------|---------------|---------------|
## not recommend |             7 |            24 |            31 | 
##               |         0.226 |         0.774 |         0.500 | 
##               |         0.200 |         0.889 |               | 
##               |         0.113 |         0.387 |               | 
## --------------|---------------|---------------|---------------|
##  Column Total |            35 |            27 |            62 | 
##               |         0.565 |         0.435 |               | 
## --------------|---------------|---------------|---------------|
## 
## </code></pre>
<p>结果似乎还不错，有3个不推荐的分类为了推荐，另有7个推荐的分类为了不推荐。比起错过好番，我更怕遇到烂番，因为我稍微有些强迫症，一旦看了某个番剧，就会把它坚持看完，哪怕它再烂。看看是哪些番剧分类错了吧：</p>
<pre class="r"><code>anime_test %&gt;% bind_cols(predict = anime_pred) %&gt;% 
  select(name, recommend, predict) %&gt;% 
  filter(recommend != predict) %&gt;% 
  knitr::kable(digits = 2)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">name</th>
<th align="left">recommend</th>
<th align="left">predict</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">再见，绝望先生</td>
<td align="left">recommend</td>
<td align="left">not recommend</td>
</tr>
<tr class="even">
<td align="left">我的妹妹不可能那么可爱</td>
<td align="left">recommend</td>
<td align="left">not recommend</td>
</tr>
<tr class="odd">
<td align="left">我的妹妹不可能那么可爱第二季</td>
<td align="left">recommend</td>
<td align="left">not recommend</td>
</tr>
<tr class="even">
<td align="left">甲铁城的卡巴内瑞</td>
<td align="left">not recommend</td>
<td align="left">recommend</td>
</tr>
<tr class="odd">
<td align="left">齐木楠雄的灾难</td>
<td align="left">recommend</td>
<td align="left">not recommend</td>
</tr>
<tr class="even">
<td align="left">暗杀教室Q</td>
<td align="left">not recommend</td>
<td align="left">recommend</td>
</tr>
<tr class="odd">
<td align="left">擅长捉弄的高木同学</td>
<td align="left">recommend</td>
<td align="left">not recommend</td>
</tr>
<tr class="even">
<td align="left">卫宫家今天的饭</td>
<td align="left">not recommend</td>
<td align="left">recommend</td>
</tr>
<tr class="odd">
<td align="left">MegaloBox</td>
<td align="left">recommend</td>
<td align="left">not recommend</td>
</tr>
<tr class="even">
<td align="left">千绪的通学路</td>
<td align="left">recommend</td>
<td align="left">not recommend</td>
</tr>
</tbody>
</table>
<p>暗杀教室Q作为暗杀教室的衍生剧，其实还蛮好看的，我评分的时候其实也在犹豫。有几个错的挺离谱的，比如MegaloBox，那真是强烈推荐啊；而甲铁城的卡巴内瑞，那真是强烈不推荐啊！</p>
</div>
<div id="c4." class="section level3">
<h3>c4.规则学习算法</h3>
<p>再试试规则学习算法：</p>
<pre class="r"><code>anime_JRip &lt;- JRip(recommend ~ ., data = anime_train[, -2])
anime_pred &lt;- predict(anime_JRip, anime_test[, -1:-2])

CrossTable(anime_pred, anime_test$recommend, prop.chisq = FALSE, 
           dnn = c(&#39;predicted&#39;, &#39;actual&#39;))</code></pre>
<pre><code>## 
##  
##    Cell Contents
## |-------------------------|
## |                       N |
## |           N / Row Total |
## |           N / Col Total |
## |         N / Table Total |
## |-------------------------|
## 
##  
## Total Observations in Table:  62 
## 
##  
##               | actual 
##     predicted |     recommend | not recommend |     Row Total | 
## --------------|---------------|---------------|---------------|
##     recommend |            29 |             3 |            32 | 
##               |         0.906 |         0.094 |         0.516 | 
##               |         0.829 |         0.111 |               | 
##               |         0.468 |         0.048 |               | 
## --------------|---------------|---------------|---------------|
## not recommend |             6 |            24 |            30 | 
##               |         0.200 |         0.800 |         0.484 | 
##               |         0.171 |         0.889 |               | 
##               |         0.097 |         0.387 |               | 
## --------------|---------------|---------------|---------------|
##  Column Total |            35 |            27 |            62 | 
##               |         0.565 |         0.435 |               | 
## --------------|---------------|---------------|---------------|
## 
## </code></pre>
<p>结果跟朴素贝叶斯算法差不多，只是在FN上少了1个。看下在规则学习算法下，哪些番剧被分类错了吧：</p>
<pre class="r"><code>anime_test %&gt;% bind_cols(predict = anime_pred) %&gt;% 
  select(name, recommend, predict) %&gt;% 
  filter(recommend != predict) %&gt;% 
  knitr::kable(digits = 2)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">name</th>
<th align="left">recommend</th>
<th align="left">predict</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">轻音少女 第二季</td>
<td align="left">not recommend</td>
<td align="left">recommend</td>
</tr>
<tr class="even">
<td align="left">我的妹妹不可能那么可爱</td>
<td align="left">recommend</td>
<td align="left">not recommend</td>
</tr>
<tr class="odd">
<td align="left">我的妹妹不可能那么可爱第二季</td>
<td align="left">recommend</td>
<td align="left">not recommend</td>
</tr>
<tr class="even">
<td align="left">游戏人生</td>
<td align="left">not recommend</td>
<td align="left">recommend</td>
</tr>
<tr class="odd">
<td align="left">东京喰种</td>
<td align="left">not recommend</td>
<td align="left">recommend</td>
</tr>
<tr class="even">
<td align="left">刀剑神域Ⅱ</td>
<td align="left">recommend</td>
<td align="left">not recommend</td>
</tr>
<tr class="odd">
<td align="left">擅长捉弄的高木同学</td>
<td align="left">recommend</td>
<td align="left">not recommend</td>
</tr>
<tr class="even">
<td align="left">工作细胞</td>
<td align="left">recommend</td>
<td align="left">not recommend</td>
</tr>
<tr class="odd">
<td align="left">千绪的通学路</td>
<td align="left">recommend</td>
<td align="left">not recommend</td>
</tr>
</tbody>
</table>
<p>有4个番剧，两种算法都分类错了，看来应该找找原因，但是对于俺妹系列，我似乎应该把对它们的评分改了。另外，这一算法的一个严重错误是对工作细胞的分类，这么火的番剧，怎么可能不推荐呢？</p>
</div>
</div>
<div id="d." class="section level1">
<h1>D.局限与展望</h1>
<p>第一次尝试就到此为止了，存在很多问题，比如，对于某些变量，我只是将其变为了二元分类变量，损失了很多信息。后面考虑使用决策树和随机森林等算法重新进行分类，并且打算再花些时间，建立一个验证数据集，收集30个左右我没有看过的番剧，看一看真实的效果如何。</p>
<p>这篇博客就到此为止了，这是我花时间最多的一篇博客了。</p>
<pre class="r"><code>sessionInfo()</code></pre>
<pre><code>## R version 3.5.3 (2019-03-11)
## Platform: x86_64-w64-mingw32/x64 (64-bit)
## Running under: Windows 10 x64 (build 17134)
## 
## Matrix products: default
## 
## locale:
## [1] LC_COLLATE=Chinese (Simplified)_China.936 
## [2] LC_CTYPE=Chinese (Simplified)_China.936   
## [3] LC_MONETARY=Chinese (Simplified)_China.936
## [4] LC_NUMERIC=C                              
## [5] LC_TIME=Chinese (Simplified)_China.936    
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] gmodels_2.18.1  RWeka_0.4-40    e1071_1.7-1     ggraph_1.0.2   
##  [5] igraph_1.2.4    widyr_0.1.1     tidytext_0.2.0  corrplot_0.84  
##  [9] ggthemes_4.1.1  here_0.1        readxl_1.3.1    forcats_0.4.0  
## [13] stringr_1.4.0   dplyr_0.8.0.1   purrr_0.3.2     readr_1.3.1    
## [17] tidyr_0.8.3     tibble_2.1.1    ggplot2_3.1.0   tidyverse_1.2.1
## 
## loaded via a namespace (and not attached):
##  [1] viridis_0.5.1     httr_1.4.0        jsonlite_1.6     
##  [4] viridisLite_0.3.0 modelr_0.1.4      gtools_3.8.1     
##  [7] assertthat_0.2.1  highr_0.8         cellranger_1.1.0 
## [10] yaml_2.2.0        ggrepel_0.8.0     pillar_1.3.1     
## [13] backports_1.1.3   lattice_0.20-38   glue_1.3.1       
## [16] digest_0.6.18     polyclip_1.10-0   rvest_0.3.2      
## [19] colorspace_1.4-1  htmltools_0.3.6   Matrix_1.2-15    
## [22] plyr_1.8.4        pkgconfig_2.0.2   broom_0.5.1      
## [25] haven_2.1.0       bookdown_0.9      scales_1.0.0     
## [28] gdata_2.18.0      tweenr_1.0.1      ggforce_0.2.1    
## [31] generics_0.0.2    farver_1.1.0      withr_2.1.2      
## [34] lazyeval_0.2.2    cli_1.1.0         magrittr_1.5     
## [37] crayon_1.3.4      evaluate_0.13     tokenizers_0.2.1 
## [40] janeaustenr_0.1.5 fansi_0.4.0       nlme_3.1-137     
## [43] SnowballC_0.6.0   MASS_7.3-51.1     xml2_1.2.0       
## [46] class_7.3-15      blogdown_0.11     tools_3.5.3      
## [49] RWekajars_3.9.3-1 hms_0.4.2         munsell_0.5.0    
## [52] compiler_3.5.3    rlang_0.3.3       grid_3.5.3       
## [55] rstudioapi_0.10   labeling_0.3      rmarkdown_1.12   
## [58] gtable_0.3.0      R6_2.4.0          gridExtra_2.3    
## [61] lubridate_1.7.4   knitr_1.22        utf8_1.1.4       
## [64] rprojroot_1.3-2   rJava_0.9-11      stringi_1.4.3    
## [67] Rcpp_1.0.1        tidyselect_0.2.5  xfun_0.6</code></pre>
</div>

              
            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/">机器学习</a>

                  </div>
                
              
            
            
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--disabled">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="/2019/04/mlr-note-nb/" data-tooltip="《机器学习与R语言》学习笔记02：朴素贝叶斯">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=/2019/05/anime-recommend-with-ml/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=/2019/05/anime-recommend-with-ml/">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=/2019/05/anime-recommend-with-ml/">
              <i class="fa fa-google-plus"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#">
        
          <i class="fa fa-list"></i>
        </a>
      </li>
    </ul>
  </div>


            
              
                <div id="disqus_thread"></div>
<script>





(function() { 
var d = document, s = d.createElement('script');
s.src = 'https://rrtbmxl.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
              
            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2019 孟祥良. All Rights Reserved
  </span>
</footer>

      </div>
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
        
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--disabled">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="/2019/04/mlr-note-nb/" data-tooltip="《机器学习与R语言》学习笔记02：朴素贝叶斯">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=/2019/05/anime-recommend-with-ml/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=/2019/05/anime-recommend-with-ml/">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=/2019/05/anime-recommend-with-ml/">
              <i class="fa fa-google-plus"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#">
        
          <i class="fa fa-list"></i>
        </a>
      </li>
    </ul>
  </div>


      </div>
      <div id="share-options-bar" class="share-options-bar" data-behavior="4">
  <i id="btn-close-shareoptions" class="fa fa-close"></i>
  <ul class="share-options">
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=%2F2019%2F05%2Fanime-recommend-with-ml%2F">
          <i class="fa fa-facebook-official"></i><span>Share on Facebook</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=%2F2019%2F05%2Fanime-recommend-with-ml%2F">
          <i class="fa fa-twitter"></i><span>Share on Twitter</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://plus.google.com/share?url=%2F2019%2F05%2Fanime-recommend-with-ml%2F">
          <i class="fa fa-google-plus"></i><span>Share on Google&#43;</span>
        </a>
      </li>
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>
    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="//www.gravatar.com/avatar/9a7089fad6e7d2ebee69f9659db0c484?s=110" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">孟祥良</h4>
    
      <div id="about-card-bio">R语言爱好者, 心理学专业硕士 &amp; FGO休闲玩家</div>
    
    
    
  </div>
</div>

    <div id="algolia-search-modal" class="modal-container">
  <div class="modal">
    <div class="modal-header">
      <span class="close-button"><i class="fa fa-close"></i></span>
      <a href="https://algolia.com" target="_blank" rel="noopener" class="searchby-algolia text-color-light link-unstyled">
        <span class="searchby-algolia-text text-color-light text-small">by</span>
        <img class="searchby-algolia-logo" src="https://www.algolia.com/static_assets/images/press/downloads/algolia-light.svg">
      </a>
      <i class="search-icon fa fa-search"></i>
      <form id="algolia-search-form">
        <input type="text" id="algolia-search-input" name="search"
          class="form-control input--large search-input" placeholder="Search" />
      </form>
    </div>
    <div class="modal-body">
      <div class="no-result text-color-light text-center">no post found</div>
      <div class="results">
        
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="/2019/05/anime-recommend-with-ml/">
                <h3 class="media-heading">使用机器学习给自己推荐番剧：first try</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  May 5, 2019
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">A.关于数据B.数据探索b1.番名b2.季数b3.集数b4.年份b5.季节b6.来源b7.类别b8.制作公司b9.评分及人数extra 1.个人、豆瓣与MAL的对比b0.声优extra 2.声优关系网络C.建模与评估c1.清洗数据c2.创建训练数据集和测试数据集c3.朴素贝叶斯算法c4.规则学习算法D.局限与展望花费许多时间学到的东西自然是要用一用的，如果工作中用不到的话，那就用来为生活增添些许乐趣吧。
看番多年，难免遇到烂番，既浪费时间，又影响心情；另外，有些优秀的番剧，可能因为某些原因，与自己失之交臂。要是能在自己看过的番剧的基础上，建立一个模型，帮自己避免烂番，发掘好番，那真是再好不过了。于是我就把自己近年来看过的番剧整理了一下，收集了若干相关信息，做成了excel表格，作为建立模型的原材料。数据是手动整理的，花费的时间比我预计的多很多，但在整理的过程中，也引发了不少回忆，所以也算不上是浪费时间。
A.关于数据数据就是我看番的记录，不全，但应该是足够用了。反应变量是我对某番剧的评分，从5分到10分，是离散数据，在这第一次尝试中，计划将其变为二元分类数据，即5分到7分为不推荐，8分到10分为推荐。预测变量有十来个，包括番剧的年代、类型、制作公司、声优和网站评分等信息，在第一次尝试中，计划把数据弄成稀疏矩阵，使用朴素贝叶斯算法和规则学习算法来进行分类。
在查看数据之前，先载入分析需要用到的包：
library(tidyverse)library(readxl)library(here)library(ggthemes)library(corrplot)library(tidytext)library(widyr)library(igraph)library(ggraph)library(e1071)library(RWeka)library(gmodels)然后导入数据，并进行初步的清洗：
anime &lt;- read_xlsx(here(&#39;content&#39;, &#39;post&#39;, &#39;data&#39;, &#39;anime_record.xlsx&#39;)) %&gt;%mutate_all(str_remove_all, pattern = &#39;\U00A0&#39;) %&gt;% # 去掉不间断空格&lt;U+00A0&gt;select(-record_time) %&gt;%mutate(studio = str_remove(studio, &#39;,.*&#39;)) %&gt;%mutate_at(vars(c(&#39;season_number&#39;, &#39;episode&#39;, &#39;year&#39;, &#39;rating&#39;, &#39;db_number&#39;, &#39;mal_number&#39;)), as.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="/2019/04/mlr-note-nb/">
                <h3 class="media-heading">《机器学习与R语言》学习笔记02：朴素贝叶斯</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Apr 4, 2019
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">书中的第二个例子是利用朴素贝叶斯算法判断垃圾短信。
首先载入需要用到的包：
library(tidyverse) # 清洗数据library(here) # 设置数据文件路径library(tidytext) # 分词及创建稀疏矩阵library(e1071) # 建模library(gmodels) # 评估模型在清洗数据的时候遇到一定的困难，因为书中是用tm包进行文本处理的，而我完全没有用过这个包（甚至也没有装这个包），所以看书中的代码就只能凭感觉脑补了。不过，还好，最后还是成功写出了tidyverse化的数据清洗代码，如下：
sms &lt;- read_csv(here(&#39;content&#39;, &#39;post&#39;, &#39;data&#39;, &#39;02-sms_spam.csv&#39;)) %&gt;% mutate(type = factor(type),row = row_number()) %&gt;% unnest_tokens(word, text) %&gt;% anti_join(stop_words) %&gt;% filter(!str_detect(word, &#39;\\d&#39;)) %&gt;% cast_sparse(row, word) %&gt;% as.matrix() %&gt;% as_tibble() %&gt;% select(which(colSums(.) &gt; 4)) %&gt;% bind_cols(read_csv(here(&#39;data&#39;, &#39;02-sms_spam.csv&#39;)) %&gt;% mutate(type = factor(type),row = row_number()) %&gt;% unnest_tokens(word, text) %&gt;% anti_join(stop_words) %&gt;% filter(!str_detect(word, &#39;\\d&#39;)) %&gt;%select(-3) %&gt;% distinct()) %&gt;% mutate_if(is.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="/2019/04/mlr-note-knn/">
                <h3 class="media-heading">《机器学习与R语言》学习笔记01：kNN</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Apr 4, 2019
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">通过将《机器学习与R语言》一书中的代码tidyverse化，来学习这本书。
书中第一个例子是利用kNN算法来诊断乳腺癌。
首先载入需要用到的包：
library(tidyverse) # 清洗数据library(here) # 设置数据文件路径library(knitr) # 呈现更好看的表格library(kableExtra) # 同上library(class) # 使用包中的knn()函数library(gmodels) # 使用包中的CrossTable()函数然后导入数据并清洗：
wbcd &lt;- read_csv(here(&#39;content&#39;, &#39;post&#39;, &#39;data&#39;, &#39;01-wisc_bc_data.csv&#39;)) %&gt;% select(-id) %&gt;% mutate(diagnosis = factor(diagnosis, levels = c(&#39;B&#39;, &#39;M&#39;),labels = c(&#39;Benign&#39;, &#39;Malignant&#39;))) %&gt;% mutate_if(is.numeric, ~ (.x - min(.x)) / (max(.x) - min(.x)))首先使用here函数找到数据文件的路径，然后使用read_csv函数将其读入R中；随后通过select函数将id变量去掉；然后利用mutate函数将diagnosis变量改为因子型；最后利用mutate_if函数，将所有数值型的变量进行min-max标准化，这里用到了公式化的匿名函数，可以使代码更为简练。此时的数据是这样的：
wbcd %&gt;% head() %&gt;% kable() %&gt;% kable_styling(bootstrap_options = &quot;striped&quot;, font_size = 12) %&gt;%scroll_box(width = &quot;100%&quot;) diagnosisradius_meantexture_meanperimeter_meanarea_meansmoothness_meancompactness_meanconcavity_meanconcave points_meansymmetry_meanfractal_dimension_meanradius_setexture_seperimeter_searea_sesmoothness_secompactness_seconcavity_seconcave points_sesymmetry_sefractal_dimension_seradius_worsttexture_worstperimeter_worstarea_worstsmoothness_worstcompactness_worstconcavity_worstconcave points_worstsymmetry_worstfractal_dimension_worstMalignant0.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="/2019/04/r-resources-collection/">
                <h3 class="media-heading">R语言学习资源总结</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Apr 4, 2019
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">ArticleConceptHistoryCommunicationBlogdownReportShinyWordMachine LearningBasicsClassificationClusteringDeep LearningDimensionality ReductionPredictionProgramEvaluationFunctionLoopPipeTutorialData AcquisitionOnlinebookTidyverseWebsiteVisualizationAdjustmentBasicCommon PlotsColorExtensionLine ChartMapScatter PlotTheory总结一下我自己看过的R语言学习资源，目前的分类还比较随意，因为很多内容都是交叉的，难以形成明确的体系。没啥特殊情况的话，每个周末都会补充新的内容。另外要强调一点，看教程虽然有助于学习，但真正能提升水平的，还是实践。如果工作中没有太多实践的机会的话，那也要自己想办法找些实践的机会。
还要吐槽一下，不论是tidyverse还是Rmarkdown，对中文的支持都不是很好，用中文标题生成的TOC无法跳转，所以我只好暂时把各部分的标题都写成英文了，以后有时间再琢磨这个问题。不过话说回来，确实是写成英文更方便点，因为我收藏夹里的文件夹名都是英文命名的，而这篇博客其实就是对我的收藏夹内容的总结。
Article收集了一些关于R的概念和历史的文章。
ConceptExplain R environments like I’m five (181110; 190307)
介绍什么是R语言的环境，非常简单易懂。
Environments in R (190128; 190408)</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="/2019/04/r-notebook-and-plan/">
                <h3 class="media-heading">R学习笔记及学习计划</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Apr 4, 2019
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">人对事物的认识大概可以分为三个层次，从“未知的未知”到“已知的未知”再到“已知的已知”。如果确实是这样的话，那学习就可以分为两种，一种是把“未知的未知”变为“已知的未知”，如了解到这个世界上存在一种叫做“负数”的东西，但不知道它究竟指什么；另一种是把“已知的未知”变为“已知的已知”，如通过进一步的了解，获知“负数”的确切意义。德尔菲的神谕认为没有人比苏格拉底更聪明，其看重的可能并不在于苏格拉底是否比其他所有人拥有更多“已知的已知”，而是看到他比其他人拥有更多“已知的未知”。我不知道两种学习中哪一种更为重要，但我觉得，在大多数情况下，前一种学习都是后一种学习的先决条件。人的时间是有限的，没法把所有的知识都掌握，所以比较好的学习思路可能是先去获取足够多的“已知的未知”，再决定把哪些“已知的未知”转变为“已知的已知”。
我接触R已经三年多了，但真正开始学习R，也就一年多的样子。我对R本身其实没有多大的兴趣，但当我把tidyverse变为“已知的未知”时，才对这门语言产生了热情。翻开哲学的入门书，很有可能会发现最开始的章节是以苏格拉底来划分的，如类似“前苏格拉底时代的哲学家们”的说法。在这里，我也想用tidyverse这个词来对我的笔记章节进行划分（当然，tidyverse对应的哲学家更有可能是笛卡尔），具体来说，包括tidyverse之前，用来介绍R的一些基本知识；tidyverse之内，用来介绍tidyverse核心包的使用方法；tidyverse之上，用来介绍建立在tidyverse核心包基础上的一些实用的包；tidyverse之外，用来介绍与tidyverse无关，但很有用的一些包。当然，这些内容中的很大一部分对我来说还是“已知的未知”。
想弄这么个东西，目的主要有两个：一方面，把自己会的东西以教程的形式写出来，能让自己把“已知的已知”掌握得更牢固；另一方面，也能督促自己不断地去学习新知识，探索“未知的未知”，转化“已知的未知”。因此，内容方面，就包括我目前会的，和我将来想学的，具体内容可以看后面暂定的大纲。另外，我也给自己设定了几个要求：
术语尽量给出参考资料和对应的英文，不知道该如何翻译的直接用英文，符号给出对应的英文及其读音；
尽量保证所有的内容都能跟上R本体和所涉及的包的更新；
暂定的提纲如下：
tidyverse之前R的介绍及安装
R的基本概念及操作
R中的条件与循环
tidyveRse之内使用readr导入数据
使用rvest获取网络数据
dbplyr与数据库
dplyr包常用操作及管道操作符
tidyr包常用操作及tidy data
stringr包常用操作及正则表达式
forcats常用操作
lubridate常用操作
purrr包探索
组合使用
tidyverse代码风格
ggplot2基本统计图的绘制
ggplot2统计图的调整
ggplot2统计图的美化
tidyverse之上使用tidytext进行文本分析
使用ggvis绘制交互统计图
使用gganimate绘制动态统计图
tidyverse之外使用rmarkdown撰写报告
使用blogdown搭建博客
使用shiny制作网络应用</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="/2019/03/r-basic-concept-and-operation/">
                <h3 class="media-heading">R的基本概念和操作</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Mar 3, 2019
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">R的基本操作a.计算b.逻辑运算c.赋值R的基本概念a.数据结构数据探索b.函数c.包190424
R的基本操作a.计算R可以作为计算器使用，+、-、*、/、^分别代表加减乘除和乘方：
2 ^ 2 / 2 - (2 * 2 + 2)## [1] -4%%求余数，%/%求商：
5 %% 2## [1] 15 %/% 2## [1] 2b.逻辑运算==、!=、&gt;、&gt;=、&lt;、&lt;=分别用来判断相等、不等、大于、大于等于、小于、小于等于的关系，符合逻辑返回TRUE，反之返回FALSE。对于部分字符（英文字母和汉字），似乎是字母顺序排在后面的更大；对于字符型数值，似乎与其数值型数值相等；另外，逻辑型数值中，TRUE等于1，而FALSE等于0：
TRUE == 1## [1] TRUEFALSE == 0## [1] TRUE&#39;白马&#39; != &#39;马&#39;## [1] TRUE1 == &#39;1&#39;## [1] TRUE&#39;x&#39; &lt; &#39;y&#39;## [1] TRUE&#39;一&#39; &gt; &#39;二&#39;## [1] TRUEc.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="/2019/02/reading-records-analysis/">
                <h3 class="media-heading">11年-19年读书记录分析</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Feb 2, 2019
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">大概在10年前后，镇上给村里弄了个农村书屋，其他办公室都没地方，就把书连书柜都放我办公室里了。当时统计了下，一共有1500多本书，后来又给了一批，最终达到1800多本。这些书中的大部分质量和内容都很一般，但还是有几本好书的。反正工作也挺闲的，每天就靠看书打发点时间。时过境迁，工作已经换了几个，但看书的习惯还一直保持着。
我从12年开始记日记，所以从那一年起，哪段时间看了哪本书都有记录。前几年把读书的记录整理过一次，但信息不全；今年过年前后，花了几天的时间又整理了一遍，添加了一些书籍相关的信息，就想着要不要也分析下（其实只是统计，并没有分析），算是对这些年自己读书的一个总结。有点遗憾的是，11年的记录只找到10月份到12月份的一部分，10月份以前的则完全没有记录，就没法统计进来了。
但在分析之前，还得说明一下，有些书我没有进行统计，这些书包括以下四种：
国产教材。比如为考研而看的《普通心理学》《心理学导论》之类的，但国外的教材，如《心理学与生活》等，不在此列。
技术类的书。如跟R相关的书，有实体的，也有在线的，都没有被统计进来。
电子书。不论是在手机上，kindle上，还是在更早的汉王上看的电子书，都没有统计进来。在看书这方面，我还是比较传统的，现在基本上只看实体书。
太low的书。如，有套书名叫《卑鄙的圣人：曹操》，老爹看见了，非要买一套，当时只出了5本，就都买了下来。我是家里有的书就要看完的（大概就是看完这套书后改了这个“毛病”），就硬着头皮把这几本书看了一遍。听说这套书让作者赚了一百多万的版税，但这也无法掩盖作者文笔一般、词汇匮乏的事实。印象最深的是，曹操笑起来是“噗嗤”，袁绍笑起来也“噗嗤”，连曹操的老子曹嵩笑起来也“噗嗤”，这到底是一群大老爷们，还是一群小丫头片子啊（当然，用在曹嵩身上也许是合适的）？总之，这类书就不进行统计了。
去掉以上四类书之后，剩下的书（共计465本次），就是要进行分析的了。
首先还是载入分析需要用到的包：
library(tidyverse)library(readxl)library(knitr)然后把数据导入并进行清洗。由于数据已经在excel里整理好了，所以也没啥好清洗的，只是对每本书的字数进行了校正：
book &lt;- read_xlsx(&#39;读书记录.xlsx&#39;) %&gt;% select(year = 2, name = 4, publisher = 6, author = 7, country = 8, dynasty = 9, classification = 10, language = 11, price = 12, page = 13, words = 14, manner = 15) %&gt;% mutate(words = case_when(language %in% c(&#39;古汉&#39;, &#39;英汉&#39;) ~ words*1.3,language %in% c(&#39;古语&#39;, &#39;英语&#39;) ~ words*2,TRUE ~ words),words = ifelse(manner == &#39;书内&#39;, words*.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="/2019/01/pseudo-dynamic-website-scraping/">
                <h3 class="media-heading">（伪）动态网页爬虫-《狗十三》豆瓣短评爬取</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jan 1, 2019
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">这周公司组织了电影赏析，看的电影是《狗十三》。我之前并没有看过这部电影，就想着先去豆瓣上看一下评论。这电影的评论还不少，有好几百条，完全可以全爬下来，分析一下。拉到页面下面，点击后页，url就会跟着变化（start=那里），说明这也不是啥动态网页，完全可以写个循环，用rvest包一页一页的爬。但实际爬取的时候，遇到了问题，就是未登陆的状态下，只能爬前220条评论。我搜索了一下模拟登录的办法，似乎是成功了，但后续该怎么弄，我就不知道了。我在这里卡了一天，没想到解决办法。昨天早上躺在被窝里，突然想到，我之前研究了下用RSelenium爬取动态网页，这里我完全可以先用RSelenium模拟登录，然后把网页当成动态网页爬啊。试了一下，成功了，下面就是相关的操作过程。
首先还是载入需要用的包，要使用RSelenium包，还要先进行一些配置，具体内容可以看RSelenium包的官方网站（这网站好像需要科学上网）：
library(tidyverse)library(RSelenium)library(rvest)library(jiebaR)library(wordcloud2)library(knitr)接下来跟Selenium Server进行连接，这里我用的是Chrome浏览器（变量名rd本应该在第一行，不知道为什么跑到下边去了……）：
 rd &lt;- remoteDriver(remoteServerAddr = &quot;localhost&quot;,port = 4444L,browserName = &quot;chrome&quot;)然后模拟打开豆瓣电影的登录页面，输入用户名和密码，点击登录按键，就可以登录了：
rd$open()rd$navigate(&#39;https://www.douban.com/accounts/login?source=movie&#39;)we &lt;- rd$findElement(using = &#39;xpath&#39;, &#39;//*[@id=&quot;email&quot;]&#39;)we$sendKeysToElement(list(&#39;用户名&#39;))we &lt;- rd$findElement(using = &#39;xpath&#39;, &#39;//*[@id=&quot;password&quot;]&#39;)we$sendKeysToElement(list(&#39;密码&#39;))we &lt;- rd$findElement(using = &#39;xpath&#39;, &#39;//*[@id=&quot;lzform&quot;]/div[6]/input&#39;)we$clickElement()如果没接触过爬虫的，看着上面的代码可能有点懵，但实际上没啥太玄奥的东西。RSelenium包中的函数名就明白显示了它是干什么的，而参数中的那些xpath，在Chrome浏览器中都是可以直接复制出来的。
后面就可以开始爬虫了。我只爬了评价星级、短评时间、有帮助次数和短评文本四项信息。需要说明的是，有些用户虽然写了短评，但不会打分，这种情况下，我认为的将其评价星级定位“无评价”。因为不打分也会影响后面内容的xpath，所以那部分用了一些if条件。另外，虽然不知道会不会用上，在每页的内容爬取完之后，我也会让程序随机休息几秒，省得被轻易地认定为是爬虫程序。
rd$navigate(&#39;https://movie.douban.com/subject/25716096/comments?start=0&amp;limit=20&amp;sort=new_score&amp;status=P&#39;)dog13 &lt;- tibble()for (i in 1:50) {rank &lt;- character(0)time &lt;- character(0)help &lt;- character(0)text &lt;- character(0)temp &lt;- tibble()for (j in 1:20) {xpath_rank &lt;- str_c(&#39;//*[@id=&quot;comments&quot;]/div[&#39;, j, &#39;]/div[2]/h3/span[2]/span[2]&#39;)we &lt;- rd$findElement(using = &#39;xpath&#39;, xpath_rank)rank[j] &lt;- ifelse(str_length(we$getElementAttribute(&#39;title&#39;) %&gt;% unlist()) &gt; 2, &#39;无评价&#39;, we$getElementAttribute(&#39;title&#39;) %&gt;% unlist())if (str_length(we$getElementAttribute(&#39;title&#39;) %&gt;% unlist()) &lt; 3) {xpath_time &lt;- str_c(&#39;//*[@id=&quot;comments&quot;]/div[&#39;, j, &#39;]/div[2]/h3/span[2]/span[3]&#39;)we &lt;- rd$findElement(using = &#39;xpath&#39;, xpath_time)time[j] &lt;- we$getElementText() %&gt;% unlist()} else {xpath_time &lt;- str_c(&#39;//*[@id=&quot;comments&quot;]/div[&#39;, j, &#39;]/div[2]/h3/span[2]/span[2]&#39;)we &lt;- rd$findElement(using = &#39;xpath&#39;, xpath_time)time[j] &lt;- we$getElementText() %&gt;% unlist()}xpath_help &lt;- str_c(&#39;//*[@id=&quot;comments&quot;]/div[&#39;, j, &#39;]/div[2]/h3/span[1]/span&#39;)we &lt;- rd$findElement(using = &#39;xpath&#39;, xpath_help)help[j] &lt;- we$getElementText() %&gt;% unlist()xpath_text &lt;- str_c(&#39;//*[@id=&quot;comments&quot;]/div[&#39;, j, &#39;]/div[2]/p/span&#39;)we &lt;- rd$findElement(using = &#39;xpath&#39;, xpath_text)text[j] &lt;- we$getElementText() %&gt;% unlist()df &lt;- tibble(rank, time, help, text)}dog13 &lt;- bind_rows(dog13, df)rest &lt;- sample(1:10, 1)if (i &lt; 2) {we &lt;- rd$findElement(using = &#39;xpath&#39;, &#39;//*[@id=&quot;paginator&quot;]/a&#39;)we$clickElement()Sys.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="/2018/12/red-envelope/">
                <h3 class="media-heading">使用R语言模拟抢红包</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Dec 12, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">有一次参加了一个特别无聊的讲座，实在是无事可做，就琢磨了一下像微信抢红包那样的机制是如何实现的。自己当时想了一个模拟的方式，出来的结果似乎也可以以假乱真。后来把相关的代码完善了下，用来在自己组织的R语言课上讲for循环和自编函数。现在把这些内容整理出来，权当作一篇小小的教程。
首先假设，有人发了一个200块钱的红包，分给10个人抢：
money &lt;- 200people &lt;- 10给每个人安排一个随机数：
set.seed(181209)rand_number &lt;- sample(1:10000, people, replace = TRUE)rand_number## [1] 4188 591 2386 4520 3692 979 8170 3728 7121 4408随后用每个随机数除以所有随机数的总和得到一个比值，乘以总钱数，进而得到每个人的钱数：
rand_money &lt;- rand_number/sum(rand_number)*moneyrand_money## [1] 21.054219 2.971118 11.995073 22.723274 18.560692 4.921700 41.072820## [8] 18.741674 35.799211 22.160219然后就可以知道具体每个人得到多少钱了：
paste0(paste0(sample(letters, 5, replace = TRUE), collapse = &#39;&#39;),&#39;得到了&#39;, round(rand_money[1], 2), &#39;元，红包剩余&#39;, round(money - sum(rand_money[1:1]), 2), &#39;元。&#39;)## [1] &quot;hdprm得到了21.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="/2018/11/ggplot2-collection/">
                <h3 class="media-heading">ggplot2及其扩展包绘图总结</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Nov 11, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">Bar PlotBox PlotHeatmapHistgramLine ChartMapPie ChartRadar ChartScatter PlotTreemap像这样的教程应该有很多了，但为了自己查阅起来方便，我决定自己也写一个。这里我会尽量多的用到各种theme和palette，省得每次绘图还要一个一个试，看哪个好看（通过这个过程，我可能体验到了女生出门前挑衣服的感觉）。
先把需要用到的包载入：
library(tidyverse)library(ggthemes)Bar Plot直条图应该是最常见的了，在心理学论文中用到直条图时，一般都是把自变量放到x轴上，因变量放到y轴上，然后再添加误差条：
iris %&gt;% group_by(Species) %&gt;% summarise(avg_sl = mean(Sepal.Length), se = sqrt(sd(Sepal.Length)/n())) %&gt;% ggplot(aes(Species, avg_sl, fill = Species)) + geom_col(width = .5) + geom_errorbar(aes(ymin = avg_sl - se, ymax = avg_sl + se),width = .3) + scale_y_continuous(expand = c(0, 0)) + scale_fill_brewer(palette = &#39;Set2&#39;) + labs(y = &#39;Sepal.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
      </div>
    </div>
    <div class="modal-footer">
      <p class="results-count text-medium"
         data-message-zero="no post found"
         data-message-one="1 post found"
         data-message-other="{n} posts found">
         15 posts found
      </p>
    </div>
  </div>
</div>
    
  
    
    <div id="cover" style="background-image:url('/images/cover.jpg');"></div>
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.7/js/jquery.fancybox.min.js" integrity="sha256-GEAnjcTqVP+vBp3SSc8bEDQqvWAZMiHyUSIorrWwH50=" crossorigin="anonymous"></script>


<script src="/js/script-qi9wbxp2ya2j6p7wx1i6tgavftewndznf4v0hy2gvivk1rxgc3lm7njqb6bz.min.js"></script>



<script>
$(document).ready(function() {
  hljs.configure({ classPrefix: '', useBR: false });
  $('pre.code-highlight > code, pre > code').each(function(i, block) {
    if (!$(this).hasClass('codeblock')) {
      $(this).addClass('codeblock');
    }
    hljs.highlightBlock(block);
  });
});
</script>


  
    
      <script>
        var disqus_config = function () {
          this.page.url = '\/2019\/05\/anime-recommend-with-ml\/';
          
            this.page.identifier = '\/2019\/05\/anime-recommend-with-ml\/'
          
        };
        (function() {
          
          
          if (window.location.hostname == "localhost") {
            return;
          }
          var d = document, s = d.createElement('script');
          var disqus_shortname = 'rrtbmxl';
          s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
        })();
      </script>
    
  



    
  </body>
</html>

